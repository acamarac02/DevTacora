"use strict";(self.webpackChunkpmdm=self.webpackChunkpmdm||[]).push([[7078],{4095:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"pmdm_2526/ut5_persistencia/shared-preferences","title":"Shared preferences","description":"Almacenamiento persistente de datos simples.","source":"@site/docs/01_pmdm_2526/ut5_persistencia/3-shared-preferences.md","sourceDirName":"01_pmdm_2526/ut5_persistencia","slug":"/pmdm_2526/ut5_persistencia/shared-preferences","permalink":"/DevTacora/docs/pmdm_2526/ut5_persistencia/shared-preferences","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"Shared preferences","title":"Shared preferences"},"sidebar":"pmdm_2526_Sidebar","previous":{"title":"Marcar como favorito","permalink":"/DevTacora/docs/pmdm_2526/ut5_persistencia/room/favorito-elementos"},"next":{"title":"Firebase","permalink":"/DevTacora/docs/pmdm_2526/ut5_persistencia/firebase/"}}');var a=s(4848),i=s(8453);const o={sidebar_position:3,sidebar_label:"Shared preferences",title:"Shared preferences"},l=void 0,d={},c=[{value:"SharedPreferences",id:"sharedpreferences",level:2},{value:"Crear SharedPreferences y guardar datos",id:"crear-sharedpreferences-y-guardar-datos",level:3},{value:"Leer datos",id:"leer-datos",level:3},{value:"Eliminar datos",id:"eliminar-datos",level:3},{value:"Limpiar todas las preferencias",id:"limpiar-todas-las-preferencias",level:3},{value:"Tipos de datos que puedes guardar",id:"tipos-de-datos-que-puedes-guardar",level:3},{value:"Buenas pr\xe1cticas",id:"buenas-pr\xe1cticas",level:3},{value:"AlertDialog",id:"alertdialog",level:2},{value:"Ejemplo de uso",id:"ejemplo-de-uso",level:2}];function t(e){const r={admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"hidden-summary",children:(0,a.jsx)(r.p,{children:"Almacenamiento persistente de datos simples."})}),"\n",(0,a.jsxs)("div",{class:"justify-text",children:[(0,a.jsx)(r.h2,{id:"sharedpreferences",children:"SharedPreferences"}),(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.code,{children:"SharedPreferences"})," es una API de Android que permite almacenar datos ",(0,a.jsx)(r.strong,{children:"clave-valor"})," de manera persistente. Se usa para guardar configuraciones, preferencias del usuario o estados de la aplicaci\xf3n."]}),(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.strong,{children:"Ligero y r\xe1pido."})}),"\n",(0,a.jsxs)(r.li,{children:["Los datos se ",(0,a.jsx)(r.strong,{children:"mantienen incluso si la app se cierra o el dispositivo se reinicia"}),"."]}),"\n",(0,a.jsxs)(r.li,{children:["Ideal para guardar ",(0,a.jsx)(r.strong,{children:"datos peque\xf1os"})," como booleanos, strings, enteros o floats."]}),"\n"]}),(0,a.jsxs)(r.p,{children:["Algunos casos de uso de las ",(0,a.jsx)(r.code,{children:"SharedPreferences"})," pueden ser:"]}),(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Guardar configuraci\xf3n del usuario"})," (modo oscuro, idioma, etc.)."]}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.strong,{children:"Detectar primer acceso o tutorial completado."})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.strong,{children:"Guardar tokens o identificadores simples."})}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Estados de conmutadores"})," (",(0,a.jsx)(r.code,{children:"Switch"})," o ",(0,a.jsx)(r.code,{children:"CheckBox"}),")."]}),"\n"]}),(0,a.jsx)(r.h3,{id:"crear-sharedpreferences-y-guardar-datos",children:"Crear SharedPreferences y guardar datos"}),(0,a.jsxs)(r.p,{children:["Recuperamos las ",(0,a.jsx)(r.code,{children:"SharedPreferences"})," con el m\xe9todo ",(0,a.jsx)(r.code,{children:"getSharedPreferences"}),", que espera dos par\xe1metros:"]}),(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Nombre del archivo"}),': "prefs" es simplemente el nombre del archivo donde se almacenar\xe1n los datos de ',(0,a.jsx)(r.code,{children:"SharedPreferences"}),". Puedes usar cualquier nombre de archivo que desees y este se guardar\xe1 en el almacenamiento interno de la app. Puedes tener m\xfaltiples archivos de preferencias, cada uno con un nombre diferente."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Modo de apertura"}),": ",(0,a.jsx)(r.code,{children:"MODE_PRIVATE"})," indica que las preferencias solo ser\xe1n accesibles por la aplicaci\xf3n que las cre\xf3. Es la forma m\xe1s segura y recomendada."]}),"\n"]}),(0,a.jsxs)(r.p,{children:["Por otro lado, para almacenar datos necesitamos un ",(0,a.jsx)(r.code,{children:"Editor"}),", a partir del cual usaremos los m\xe9todos ",(0,a.jsx)(r.code,{children:"putBoolean"}),", ",(0,a.jsx)(r.code,{children:"putString"}),", etc."]}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'// El MODE_PRIVATE indica que las preferencias solo ser\xe1n accesibles por la aplicaci\xf3n que las cre\xf3.\nSharedPreferences preferences = getSharedPreferences("prefs", Context.MODE_PRIVATE);\n// Editor para modificar los datos\nSharedPreferences.Editor editor = preferences.edit();\n\n// Guardar datos\neditor.putBoolean("primer_ingreso", true);\neditor.putString("usuario", "Juan");\neditor.putInt("nivel", 5);\neditor.apply();  // Guarda los cambios (as\xedncrono)\n'})}),(0,a.jsx)(r.h3,{id:"leer-datos",children:"Leer datos"}),(0,a.jsxs)(r.p,{children:["Para la lectura podemos utilizar los m\xe9todos ",(0,a.jsx)(r.code,{children:"getBoolean"}),", ",(0,a.jsx)(r.code,{children:"getString"}),", etc. Como segundo par\xe1metro admite un valor por defecto, que se asignar\xe1 a la variable en caso de que la clave buscada no exista en las ",(0,a.jsx)(r.code,{children:"SharedPreferences"}),"."]}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'// Aseg\xfarate de usar el nombre del archivo correcto\nSharedPreferences preferences = getSharedPreferences("prefs", Context.MODE_PRIVATE);\n\n// Leer datos (con valores por defecto si no existe)\nboolean primerIngreso = preferences.getBoolean("primer_ingreso", false);\nString usuario = preferences.getString("usuario", "Desconocido");\nint nivel = preferences.getInt("nivel", 0);\n'})}),(0,a.jsx)(r.h3,{id:"eliminar-datos",children:"Eliminar datos"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'SharedPreferences.Editor editor = preferences.edit();\neditor.remove("usuario");  // Elimina una clave espec\xedfica\neditor.apply();\n'})}),(0,a.jsx)(r.h3,{id:"limpiar-todas-las-preferencias",children:"Limpiar todas las preferencias"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:"editor.clear();  // Elimina TODAS las claves guardadas\neditor.apply();\n"})}),(0,a.jsx)(r.h3,{id:"tipos-de-datos-que-puedes-guardar",children:"Tipos de datos que puedes guardar"}),(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"String"})," \u2192 ",(0,a.jsx)(r.code,{children:'putString("clave", "valor")'})]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Boolean"})," \u2192 ",(0,a.jsx)(r.code,{children:'putBoolean("clave", true)'})]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Int"})," \u2192 ",(0,a.jsx)(r.code,{children:'putInt("clave", 10)'})]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Float"})," \u2192 ",(0,a.jsx)(r.code,{children:'putFloat("clave", 5.5f)'})]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Long"})," \u2192 ",(0,a.jsx)(r.code,{children:'putLong("clave", System.currentTimeMillis())'})]}),"\n"]}),(0,a.jsx)(r.h3,{id:"buenas-pr\xe1cticas",children:"Buenas pr\xe1cticas"}),(0,a.jsx)(r.p,{children:"Para centralizar la gesti\xf3n de las preferencias es recomendable crear una clase que encapsule su l\xf3gica, utilizando constantes para las claves y m\xe9todos que establezcan los valores de cada clave y los devuelvan:"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",metastring:'title="SharedPreferencesHelper.java"',children:'public class SharedPreferencesHelper {\n\n    private SharedPreferences sharedPreferences;\n\n    private static final String PREFS_NAME = "prefs";\n    private static final String KEY_PRIMER_INGRESO = "primer_ingreso";\n\n    public SharedPreferencesHelper(Context context) {\n        sharedPreferences = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);\n    }\n\n    public void guardarPrimerIngreso(boolean primerIngreso) {\n        sharedPreferences.edit().putBoolean(KEY_PRIMER_INGRESO, primerIngreso).apply();\n    }\n    \n    public boolean obtenerPrimerIngreso() {\n        // Si no existe en el almacenamiento, consideramos que es el primer ingreso\n        return sharedPreferences.getBoolean(KEY_PRIMER_INGRESO, true);\n    }\n\n}\n'})}),(0,a.jsx)(r.p,{children:"Su uso ser\xeda similar al siguiente:"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:"SharedPreferencesHelper helper = new SharedPreferencesHelper(this);\nboolean isPrimerIngreso = helper.obtenerPrimerIngreso();\nhelper.guardarPrimerIngreso(false);\n"})}),(0,a.jsx)(r.hr,{}),(0,a.jsx)(r.h2,{id:"alertdialog",children:"AlertDialog"}),(0,a.jsxs)(r.p,{children:["Un ",(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"AlertDialog"})})," es una ventana emergente (popup) que aparece sobre la interfaz de usuario para mostrar mensajes, advertencias o pedir confirmaci\xf3n al usuario."]}),(0,a.jsx)(r.p,{children:"Sus caracter\xedsticas principales son:"}),(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.strong,{children:"No interrumpe el flujo de la actividad."})}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Bloquea la interacci\xf3n con otros elementos"})," hasta que el usuario interact\xfaa con el di\xe1logo."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Opcionalmente puede tener botones"}),":","\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Positivo (OK, Aceptar)"}),"."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Negativo (Cancelar)"}),"."]}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.strong,{children:"Neutral (Opcional para otra acci\xf3n como 'M\xe1s tarde')."})}),"\n"]}),"\n"]}),"\n"]}),(0,a.jsxs)(r.p,{children:["Los principales par\xe1metros que admite un ",(0,a.jsx)(r.code,{children:"AlertDialog"})," son:"]}),(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"setTitle()"})}),": T\xedtulo del di\xe1logo."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"setMessage()"})}),": Mensaje dentro del popup."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"setPositiveButton()"})}),": Bot\xf3n de acci\xf3n positiva (ej: Aceptar, Guardar)."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"setNegativeButton()"})}),": Bot\xf3n de acci\xf3n negativa (ej: Cancelar)."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"setNeutralButton()"})}),": Bot\xf3n neutral (ej: M\xe1s tarde)."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"setView()"})}),": Permite a\xf1adir una vista personalizada (como un ",(0,a.jsx)(r.code,{children:"EditText"}),")."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"setItems()"})}),": Lista de opciones."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"setCancelable()"})}),": Controla si el usuario puede cerrar el di\xe1logo tocando fuera de \xe9l o presionando el bot\xf3n de atr\xe1s (Back)."]}),"\n"]}),(0,a.jsx)(r.p,{children:"Como puedes observar son altamente personalizables."}),(0,a.jsxs)(r.p,{children:["Ejemplo de un ",(0,a.jsx)(r.code,{children:"AlertDialog"})," simple con bot\xf3n de Aceptar y Cancelar:"]}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'new AlertDialog.Builder(this)\n    .setTitle("Confirmar")\n    .setMessage("\xbfEst\xe1s seguro de eliminar este elemento?")\n    .setPositiveButton("S\xed", (dialog, which) -> {\n        // Acci\xf3n al presionar S\xed\n        // Funci\xf3n lambda que recibe una referencia al di\xe1logo y la referencia del bot\xf3n que fue presionado (which) \n    })\n    .setNegativeButton("Cancelar", (dialog, which) -> {\n        dialog.dismiss();  // Cierra el di\xe1logo\n    })\n    .show();\n'})}),(0,a.jsx)(r.h2,{id:"ejemplo-de-uso",children:"Ejemplo de uso"}),(0,a.jsx)(r.p,{children:"En este tutorial vamos ampliar la aplicaci\xf3n anterior, de modo que si es la primera vez que accedemos se mostrar\xe1 un PopUp de bienvenida al usuario. El procedimiento a seguir ser\xe1:"}),(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Guardar un valor booleano"})," en ",(0,a.jsx)(r.code,{children:"SharedPreferences"})," indicando si el usuario ha accedido por primera vez."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Mostrar un Popup de bienvenida"})," (",(0,a.jsx)(r.code,{children:"AlertDialog"}),") si es la primera vez."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsxs)(r.strong,{children:["Actualizar ",(0,a.jsx)(r.code,{children:"SharedPreferences"})]})," para que no se vuelva a mostrar el Popup."]}),"\n"]}),(0,a.jsxs)(r.p,{children:["Como queremos que se muestre nada m\xe1s iniciar la aplicaci\xf3n, podemos incluir este c\xf3digo en la ",(0,a.jsx)(r.code,{children:"MainActivity"}),". Ten en cuenta que estamos utilizando la clase ",(0,a.jsx)(r.code,{children:"SharedPreferencesHelper"})," creada en el apartado de Buenas pr\xe1cticas."]}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",metastring:'title="MainActivity.java"',children:'public class MainActivity extends AppCompatActivity {\n\n    private static final String PREFERENCIAS = "prefs";\n    private static final String PRIMER_INGRESO = "primer_ingreso";\n\n    private SharedPreferencesHelper helper;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        // Inicializamos la clase helper\n        helper = new SharedPreferencesHelper(this);\n\n        // Recuperar la clave "primer_ingreso"\n        // La primera vez que ingresemos esa clave no existir\xe1 y por eso la ponemos a true por defecto\n        boolean esPrimeraVez = helper.obtenerPrimerIngreso();\n\n        if (esPrimeraVez) {\n            mostrarPopupBienvenida();\n        }\n    }\n\n    private void mostrarPopupBienvenida() {\n        new AlertDialog.Builder(this)\n                .setTitle("\xa1Bienvenido!")\n                .setMessage("Gracias por instalar nuestra aplicaci\xf3n. \xa1Esperamos que te guste!")\n                .setPositiveButton("Entendido", (dialog, which) -> {\n                    // Guardar que ya se mostr\xf3 el Popup\n                    helper.guardarPrimerIngreso(false);\n\n                    // Cerramos el PopUp\n                    dialog.dismiss();\n                })\n                .setCancelable(false)\n                .show();\n    }\n}\n'})}),(0,a.jsx)(r.admonition,{type:"info",children:(0,a.jsxs)(r.p,{children:["Otras herramientas que puedes utilizar para crear mensajes con botones de acci\xf3n son ",(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"Snackbar"})})," o ",(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"DialogFragment"})}),". Este \xfaltimo es similar a ",(0,a.jsx)(r.code,{children:"AlertDialog"})," pero permite crear layouts m\xe1s complejos y personalizables."]})}),(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{alt:"UT5. PopUp de Bienvenida",src:s(4937).A+"",width:"406",height:"856"})})]})]})}function p(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},4937:(e,r,s)=>{s.d(r,{A:()=>n});const n=s.p+"assets/images/8-video-popup-4b716f808022632f0982ea1a419850e5.gif"},8453:(e,r,s)=>{s.d(r,{R:()=>o,x:()=>l});var n=s(6540);const a={},i=n.createContext(a);function o(e){const r=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);