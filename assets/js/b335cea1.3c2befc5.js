"use strict";(self.webpackChunkpmdm=self.webpackChunkpmdm||[]).push([[1640],{28453:(e,n,o)=>{o.d(n,{R:()=>l,x:()=>s});var a=o(96540);const i={},r=a.createContext(i);function l(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),a.createElement(r.Provider,{value:n},e.children)}},49936:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>t});const a=JSON.parse('{"id":"pmdm_2526/ut4_componentes_avanzados/tutorial-pokedex","title":"Tutorial: Pok\xe9dex","description":"Gu\xeda paso a paso para implementar la Pok\xe9dex de la PokeAPI utilizando MVVM, Retrofit y un RecyclerView. Incluye dise\xf1o del layout, creaci\xf3n del ViewModel, Repository y mapeo del listado de Pok\xe9mon.","source":"@site/docs/01_pmdm_2526/ut4_componentes_avanzados/5-tutorial-pokedex.md","sourceDirName":"01_pmdm_2526/ut4_componentes_avanzados","slug":"/pmdm_2526/ut4_componentes_avanzados/tutorial-pokedex","permalink":"/DevTacora/docs/pmdm_2526/ut4_componentes_avanzados/tutorial-pokedex","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Tutorial: Pok\xe9dex","sidebar_position":5,"description":"Gu\xeda paso a paso para implementar la Pok\xe9dex de la PokeAPI utilizando MVVM, Retrofit y un RecyclerView. Incluye dise\xf1o del layout, creaci\xf3n del ViewModel, Repository y mapeo del listado de Pok\xe9mon.","keywords":["PokeAPI","Pok\xe9dex","Retrofit","MVVM","ViewModel","Repository","Android","Lista","RecyclerView","Tutorial"]},"sidebar":"pmdm_2526_Sidebar","previous":{"title":"Tutorial: B\xfasqueda de Pok\xe9mon","permalink":"/DevTacora/docs/pmdm_2526/ut4_componentes_avanzados/tutorial-busqueda-pkm"}}');var i=o(74848),r=o(28453);const l={title:"Tutorial: Pok\xe9dex",sidebar_position:5,description:"Gu\xeda paso a paso para implementar la Pok\xe9dex de la PokeAPI utilizando MVVM, Retrofit y un RecyclerView. Incluye dise\xf1o del layout, creaci\xf3n del ViewModel, Repository y mapeo del listado de Pok\xe9mon.",keywords:["PokeAPI","Pok\xe9dex","Retrofit","MVVM","ViewModel","Repository","Android","Lista","RecyclerView","Tutorial"]},s=void 0,d={},t=[{value:"Tutorial b\xe1sico",id:"tutorial-b\xe1sico",level:2},{value:"Paso 1. Punto de partida",id:"paso-1-punto-de-partida",level:3},{value:"Paso 2. Crear los modelos de la respuesta de Pok\xe9dex",id:"paso-2-crear-los-modelos-de-la-respuesta-de-pok\xe9dex",level:3},{value:"Paso 3. A\xf1adir el endpoint en <code>PokemonApi</code>",id:"paso-3-a\xf1adir-el-endpoint-en-pokemonapi",level:3},{value:"Paso 4. Ampliar el <code>Repository</code> con la consulta de Pok\xe9dex",id:"paso-4-ampliar-el-repository-con-la-consulta-de-pok\xe9dex",level:3},{value:"Paso 5. Ampliar el <code>ViewModel</code> con un LiveData para la Pok\xe9dex",id:"paso-5-ampliar-el-viewmodel-con-un-livedata-para-la-pok\xe9dex",level:3},{value:"Paso 6. Layout del Fragment de Pok\xe9dex y el <code>ViewHolder</code>",id:"paso-6-layout-del-fragment-de-pok\xe9dex-y-el-viewholder",level:3},{value:"Paso 7. Crear el <code>Adapter</code> para la Pok\xe9dex",id:"paso-7-crear-el-adapter-para-la-pok\xe9dex",level:3},{value:"Paso 8. Programar el <code>PokedexFragment</code> y conectar todo",id:"paso-8-programar-el-pokedexfragment-y-conectar-todo",level:3},{value:"Mejoras sobre el c\xf3digo anterior",id:"mejoras-sobre-el-c\xf3digo-anterior",level:2},{value:"Bloqueo de llamadas repetidas durante la paginaci\xf3n",id:"bloqueo-de-llamadas-repetidas-durante-la-paginaci\xf3n",level:3},{value:"Pantalla de detalle",id:"pantalla-de-detalle",level:3}];function c(e){const n={admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"En este tutorial veremos como crear la Pok\xe9dex implementando paginaci\xf3n, es decir, cuando el usuario llegue al final del RecyclerView, pediremos a la API que nos devuelva los siguientes x elementos."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Demo app",src:o(90766).A+"",width:"388",height:"866"})}),"\n",(0,i.jsx)(n.h2,{id:"tutorial-b\xe1sico",children:"Tutorial b\xe1sico"}),"\n",(0,i.jsx)(n.h3,{id:"paso-1-punto-de-partida",children:"Paso 1. Punto de partida"}),"\n",(0,i.jsx)(n.p,{children:"Partimos de que ya tienes creados del tutorial anterior:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"RetrofitClient"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"PokemonApi"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Resource<T>"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"PokemonRepository"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"PokemonViewModel"})}),"\n",(0,i.jsx)(n.li,{children:"Todo configurado para acceder a la PokeAPI"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Ahora ",(0,i.jsx)(n.strong,{children:"a\xf1adiremos solo lo necesario para listar los Pok\xe9mon"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"paso-2-crear-los-modelos-de-la-respuesta-de-pok\xe9dex",children:"Paso 2. Crear los modelos de la respuesta de Pok\xe9dex"}),"\n",(0,i.jsxs)(n.p,{children:["La respuesta de ",(0,i.jsx)(n.code,{children:"GET /pokemon"})," tiene esta estructura simplificada, de la que solo nos interesa la lista de objetos ",(0,i.jsx)(n.code,{children:"results"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "count": 1281,\n  "next": "https://pokeapi.co/api/v2/pokemon?offset=20&limit=20",\n  "previous": null,\n  "results": [\n    { "name": "bulbasaur", "url": "https://pokeapi.co/api/v2/pokemon/1/" },\n    { "name": "ivysaur",    "url": "https://pokeapi.co/api/v2/pokemon/2/" }\n  ]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Creamos dos clases en ",(0,i.jsx)(n.code,{children:"model"})," (",(0,i.jsx)(n.code,{children:"PokedexEntry"})," se ha creado como clase interna):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public class PokedexResponse {\n\n    private List<PokedexEntry> results;\n\n    public List<PokedexEntry> getResults() { return results; }\n\n    public class PokedexEntry {\n\n        private String name;\n        private String url;   // URL al detalle del Pok\xe9mon\n\n        public String getName() { return name; }\n        public String getUrl() { return url; }\n\n        // (Opcional) m\xe9todo de ayuda para obtener el id desde la URL\n        public int getIdFromUrl() {\n            // La URL termina en ".../pokemon/1/"\n            String[] partes = url.split("/");\n            String ultima = partes[partes.length - 1].isEmpty()\n                    ? partes[partes.length - 2]\n                    : partes[partes.length - 1];\n            return Integer.parseInt(ultima);\n        }\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Con ",(0,i.jsx)(n.code,{children:"getIdFromUrl()"})," luego podr\xe1s construir URLs de sprites o mostrar ",(0,i.jsx)(n.code,{children:"#001"}),", ",(0,i.jsx)(n.code,{children:"#002"}),", etc., sin hacer otra petici\xf3n."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"paso-3-a\xf1adir-el-endpoint-en-pokemonapi",children:["Paso 3. A\xf1adir el endpoint en ",(0,i.jsx)(n.code,{children:"PokemonApi"})]}),"\n",(0,i.jsx)(n.p,{children:"La PokeAPI permite obtener la lista de Pok\xe9mon con:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"GET https://pokeapi.co/api/v2/pokemon?limit=20&offset=0\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Te recomiendo revisar el apartado ",(0,i.jsx)(n.strong,{children:"An\xe1lisis de la PokeAPI"})," para entender qu\xe9 son los par\xe1metros ",(0,i.jsx)(n.em,{children:"limit"}),", ",(0,i.jsx)(n.em,{children:"offset"}),"* y entender qu\xe9 devuelve la petici\xf3n."]}),"\n",(0,i.jsxs)(n.p,{children:["En tu interfaz ",(0,i.jsx)(n.code,{children:"PokemonApi"}),", a\xf1ade un nuevo m\xe9todo:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@GET("pokemon")\nCall<PokedexResponse> getPokedex(\n        @Query("limit") int limit,\n        @Query("offset") int offset\n);\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"@Query"})," sirve para ",(0,i.jsx)(n.strong,{children:"a\xf1adir par\xe1metros a la URL"})," de la petici\xf3n."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'@Query("limit")'})," \u2192 se a\xf1ade a la URL como ",(0,i.jsx)(n.code,{children:"?limit=valor"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'@Query("offset")'})," \u2192 se a\xf1ade como ",(0,i.jsx)(n.code,{children:"&offset=valor"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Estos par\xe1metros permiten indicar:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"limit"})," \u2192 cu\xe1ntos Pok\xe9mon queremos obtener."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"offset"})," \u2192 desde qu\xe9 posici\xf3n empezar (0 = Bulbasaur)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["As\xed, usando ",(0,i.jsx)(n.code,{children:"getPokedex(151, 0)"})," la API devuelve los ",(0,i.jsx)(n.strong,{children:"151 primeros Pok\xe9mon de la Pok\xe9dex"}),".\nEn este caso, construye una llamada como:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://pokeapi.co/api/v2/pokemon?limit=151&offset=0\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"paso-4-ampliar-el-repository-con-la-consulta-de-pok\xe9dex",children:["Paso 4. Ampliar el ",(0,i.jsx)(n.code,{children:"Repository"})," con la consulta de Pok\xe9dex"]}),"\n",(0,i.jsxs)(n.p,{children:["Como explicamos anteriormente, la PokeAPI no devuelve todos los Pok\xe9mon en una sola llamada, sino que utiliza un sistema de ",(0,i.jsx)(n.strong,{children:"paginaci\xf3n"}),". Por ello, en nuestro ",(0,i.jsx)(n.code,{children:"Repository"})," guardamos estas dos variables:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"LIMIT_POKEDEX"})," \u2192 fija cu\xe1ntos Pok\xe9mon queremos que lleguen en cada petici\xf3n (20 en nuestro caso)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OFFSET_POKEDEX"})," \u2192 lleva un contador que va aumentando despu\xe9s de cada llamada, para pedir la siguiente \u201cp\xe1gina\u201d de resultados."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Cada vez que llamamos a ",(0,i.jsx)(n.code,{children:"getPokedex()"}),", enviamos a la API el ",(0,i.jsx)(n.code,{children:"limit"})," y el ",(0,i.jsx)(n.code,{children:"offset"})," actual, recibimos una lista de Pok\xe9mon y, si todo va bien, aumentamos el ",(0,i.jsx)(n.code,{children:"OFFSET_POKEDEX"})," para la siguiente p\xe1gina."]}),"\n",(0,i.jsxs)(n.p,{children:["Esto nos permite cargar la Pok\xe9dex ",(0,i.jsx)(n.strong,{children:"por bloques"}),", optimizando el rendimiento y permitiendo la paginaci\xf3n infinita en el ",(0,i.jsx)(n.code,{children:"RecyclerView"})," mediante scroll."]}),"\n",(0,i.jsxs)(n.p,{children:["En cuanto a m\xe9todos, igual que antes, en ",(0,i.jsx)(n.code,{children:"PokemonRepository"})," tenemos que a\xf1adir un ",(0,i.jsx)(n.strong,{children:"callback nuevo"})," y un ",(0,i.jsx)(n.strong,{children:"m\xe9todo para cargar la lista"}),".\nEl nuevo callback es necesario porque ahora la API no devuelve ",(0,i.jsx)(n.strong,{children:"un Pok\xe9mon"}),", sino ",(0,i.jsx)(n.strong,{children:"una lista completa"}),", y el callback anterior (",(0,i.jsx)(n.code,{children:"PokemonCallback"}),") solo estaba preparado para enviar un \xfanico objeto.\nCon un callback espec\xedfico (",(0,i.jsx)(n.code,{children:"PokedexCallback"}),"), el ViewModel recibe correctamente un ",(0,i.jsx)(n.code,{children:"Resource<List<PokedexEntry>>"})," y podemos gestionar la Pok\xe9dex como una colecci\xf3n paginada."]}),"\n",(0,i.jsx)(n.admonition,{title:"INFO SOBRE LOS CALLBACKS",type:"info",children:(0,i.jsxs)(n.p,{children:["En este tutorial usamos ",(0,i.jsx)(n.strong,{children:"un callback por operaci\xf3n"})," porque cada una devuelve un tipo de dato distinto.",(0,i.jsx)(n.br,{}),"\n","No es obligatorio hacerlo as\xed, pero ayuda a mantener el c\xf3digo sencillo y evitar mezclas de tipos."]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public class PokemonRepository {\n\n    //highlight-start\n    // Limitamos la paginaci\xf3n a 20 pok\xe9mon\n    private final static int LIMIT_POKEDEX = 20;\n\n    // Variable que se ir\xe1 incrementando tras cada petici\xf3n para la paginaci\xf3n\n    private int OFFSET_POKEDEX = 0;\n    //highlight-end\n\n    private final PokemonApi api;\n\n    public PokemonRepository() {\n        api = RetrofitClient.getPokemonApi();\n    }\n\n    // Callback para la b\xfasqueda de UN pokemon (ya lo ten\xedamos del tutorial anterior)\n    public interface PokemonCallback {\n        void onResult(Resource<Pokemon> result);\n    }\n\n    //highlight-start\n    // Nuevo callback para la lista de la Pok\xe9dex\n    public interface PokedexCallback {\n        // Directamente devolvemos la lista de Pok\xe9dex para que sea m\xe1s sencillo de procesar\n        // Por eso est\xe1 la clase PokedexResponse.PokedexEntry\n        void onResult(Resource<List<PokedexResponse.PokedexEntry>> result);\n    }\n    //highlight-end\n\n    public void getPokemon(String name, PokemonCallback callback) {\n        // C\xf3digo del tutorial anterior...\n    }\n\n    //highlight-start\n    // Nuevo m\xe9todo para obtener la Pok\xe9dex\n    public void getPokedex(PokedexCallback callback) {\n\n        // Avisamos de que empieza la carga\n        callback.onResult(Resource.loading());\n\n        api.getPokedex(LIMIT_POKEDEX, OFFSET_POKEDEX).enqueue(new Callback<PokedexResponse>() {\n            @Override\n            public void onResponse(Call<PokedexResponse> call, Response<PokedexResponse> response) {\n                if (response.isSuccessful() && response.body() != null) {\n                    // Recuperamos la lista de Pok\xe9mon directamente\n                    List<PokedexResponse.PokedexEntry> lista = response.body().getResults();\n                    callback.onResult(Resource.success(lista));\n                } else {\n                    callback.onResult(Resource.error("No se pudo cargar la Pok\xe9dex"));\n                }\n\n                // Incrementamos el offset\n                OFFSET_POKEDEX += LIMIT_POKEDEX;\n            }\n\n            @Override\n            public void onFailure(Call<PokedexResponse> call, Throwable t) {\n                callback.onResult(Resource.error("Error de red: " + t.getMessage()));\n            }\n        });\n    }\n    //highlight-end\n}\n'})}),"\n",(0,i.jsxs)(n.admonition,{title:"ADAPTA TU C\xd3DIGO A LAS CARACTER\xcdSTICAS DE TU API",type:"warning",children:[(0,i.jsxs)(n.p,{children:["La necesidad de usar ",(0,i.jsx)(n.strong,{children:"limit"}),", ",(0,i.jsx)(n.strong,{children:"offset"})," y l\xf3gica de paginaci\xf3n depende totalmente de c\xf3mo est\xe9 dise\xf1ada cada API.",(0,i.jsx)(n.br,{}),"\n","La ",(0,i.jsx)(n.strong,{children:"PokeAPI"})," organiza su contenido por p\xe1ginas, as\xed que debemos adaptar nuestro c\xf3digo a este comportamiento.",(0,i.jsx)(n.br,{}),"\n","En otras APIs los par\xe1metros pueden tener nombres distintos (",(0,i.jsx)(n.code,{children:"page"}),", ",(0,i.jsx)(n.code,{children:"cursor"}),", ",(0,i.jsx)(n.code,{children:"next"}),", etc.) o incluso no existir paginaci\xf3n."]}),(0,i.jsxs)(n.p,{children:["\u27a1\ufe0f ",(0,i.jsx)(n.strong,{children:"Revisa siempre la documentaci\xf3n de la API para aplicar el sistema correcto."})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"paso-5-ampliar-el-viewmodel-con-un-livedata-para-la-pok\xe9dex",children:["Paso 5. Ampliar el ",(0,i.jsx)(n.code,{children:"ViewModel"})," con un LiveData para la Pok\xe9dex"]}),"\n",(0,i.jsxs)(n.p,{children:["En ",(0,i.jsx)(n.code,{children:"PokemonViewModel"}),", a\xf1adimos un ",(0,i.jsx)(n.code,{children:"LiveData"})," nuevo para la lista:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class PokemonViewModel extends ViewModel {\n\n    private final PokemonRepository repository;\n    MutableLiveData<Resource<Pokemon>> informacionPokemon = new MutableLiveData<>();\n\n    //highlight-next-line\n    // LiveData para devolver la lista de Pok\xe9mon\n    MutableLiveData<Resource<List<PokedexResponse.PokedexEntry>>> pokedex = new MutableLiveData<>();\n\n    public PokemonViewModel() {\n        repository = new PokemonRepository();\n    }\n\n    public void buscarPokemon(String name) {\n        // C\xf3digo del tutorial anterior\n    }\n\n    //highlight-start\n    public void cargarPokedex() {\n        // Lanzamos la petici\xf3n\n        repository.getPokedex(result -> {\n            // Publicamos los resultados en el MLiveData\n            pokedex.postValue(result);\n        });\n    }\n    //highlight-end\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["En el Fragment observaremos este ",(0,i.jsx)(n.code,{children:"pokedex"})," igual que hac\xedas con ",(0,i.jsx)(n.code,{children:"informacionPokemon"}),", reaccionando a ",(0,i.jsx)(n.code,{children:"LOADING"}),", ",(0,i.jsx)(n.code,{children:"SUCCESS"})," y ",(0,i.jsx)(n.code,{children:"ERROR"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"paso-6-layout-del-fragment-de-pok\xe9dex-y-el-viewholder",children:["Paso 6. Layout del Fragment de Pok\xe9dex y el ",(0,i.jsx)(n.code,{children:"ViewHolder"})]}),"\n",(0,i.jsx)(n.p,{children:"En el layout a\xf1adimos los siguientes componentes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ProgressBar"})," para el estado ",(0,i.jsx)(n.code,{children:"LOADING"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"LinearLayout"})," de error para ",(0,i.jsx)(n.code,{children:"ERROR"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RecyclerView"})," para la lista (",(0,i.jsx)(n.code,{children:"SUCCESS"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="utf-8"?>\n<LinearLayout\n    xmlns:android="http://schemas.android.com/apk/res/android"\n    xmlns:tools="http://schemas.android.com/tools"\n    android:orientation="vertical"\n    android:layout_width="match_parent"\n    android:layout_height="match_parent"\n    android:padding="16dp"\n    tools:context=".PokedexFragment">\n\n    \x3c!-- \ud83d\udd04 LOADING --\x3e\n    <ProgressBar\n        android:id="@+id/progressLoadingPokedex"\n        android:layout_width="wrap_content"\n        android:layout_height="wrap_content"\n        android:layout_gravity="center_horizontal"\n        android:layout_marginTop="16dp"\n        android:visibility="gone"/>\n\n    \x3c!-- \u274c ERROR --\x3e\n    <LinearLayout\n        android:id="@+id/layoutErrorPokedex"\n        android:orientation="vertical"\n        android:gravity="center"\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:layout_marginTop="24dp"\n        android:visibility="gone">\n\n        <TextView\n            android:id="@+id/tvErrorPokedex"\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:text="No se pudo cargar la Pok\xe9dex"\n            android:textStyle="bold"\n            android:textSize="18sp"/>\n    </LinearLayout>\n\n    \x3c!-- \ud83d\udccb LISTA DE POK\xc9MON --\x3e\n    <androidx.recyclerview.widget.RecyclerView\n        android:id="@+id/recyclerPokedex"\n        android:layout_width="match_parent"\n        android:layout_height="0dp"\n        android:layout_marginTop="8dp"\n        android:layout_weight="1"\n        tools:listitem="@layout/viewholder_pokemon"/>\n\n</LinearLayout>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Y un layout sencillo para cada fila ",(0,i.jsx)(n.code,{children:"viewholder_pokemon.xml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="utf-8"?>\n<androidx.cardview.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"\n    xmlns:card_view="http://schemas.android.com/apk/res-auto"\n    android:layout_width="match_parent"\n    android:layout_height="wrap_content"\n    android:layout_margin="8dp"\n    card_view:cardCornerRadius="8dp"\n    card_view:cardElevation="4dp">\n\n    <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:orientation="horizontal"\n        android:padding="12dp">\n\n        <TextView\n            android:id="@+id/tvPokemonNumber"\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:layout_marginEnd="12dp"\n            android:text="#001"\n            android:textStyle="bold" />\n\n        <TextView\n            android:id="@+id/tvPokemonNameItem"\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:text="bulbasaur"\n            android:textSize="16sp" />\n\n    </LinearLayout>\n</androidx.cardview.widget.CardView>\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"paso-7-crear-el-adapter-para-la-pok\xe9dex",children:["Paso 7. Crear el ",(0,i.jsx)(n.code,{children:"Adapter"})," para la Pok\xe9dex"]}),"\n",(0,i.jsxs)(n.p,{children:["Creamos ",(0,i.jsx)(n.code,{children:"PokedexAdapter"})," que recibe una lista de ",(0,i.jsx)(n.code,{children:"PokedexEntry"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public class PokemonAdapter extends RecyclerView.Adapter<PokemonAdapter.PokemonViewHolder> {\n\n    // Lista de Pok\xe9mon a mostrar\n    List<PokedexResponse.PokedexEntry> pokemonList;\n    private final LayoutInflater inflater;\n\n    public PokemonAdapter(Context context) {\n        this.inflater = LayoutInflater.from(context);\n        this.pokemonList = new ArrayList<>();\n    }\n\n    @NonNull\n    @Override\n    public PokemonViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n        View view = inflater.inflate(R.layout.viewholder_pokemon, parent, false);\n        return new PokemonViewHolder(view);\n    }\n\n    @Override\n    public void onBindViewHolder(@NonNull PokemonViewHolder holder, int position) {\n        PokedexResponse.PokedexEntry entry = pokemonList.get(position);\n\n        int id = entry.getIdFromUrl();\n        String numeroFormateado = String.format("#%03d", id);\n\n        holder.binding.tvPokemonNumber.setText(numeroFormateado);\n        holder.binding.tvPokemonNameItem.setText(entry.getName());\n    }\n\n    @Override\n    public int getItemCount() {\n        return pokemonList != null ? pokemonList.size() : 0;\n    }\n\n    public void setPokemonList(List<PokedexResponse.PokedexEntry> pokemonList) {\n        this.pokemonList = pokemonList;\n        notifyDataSetChanged();\n    }\n\n    public void addPokemonList(List<PokedexResponse.PokedexEntry> nuevos) {\n        // Guardamos el \xedndice donde empieza la nueva inserci\xf3n\n        int inicio = pokemonList.size();\n\n        // A\xf1adimos al final de la lista los nuevos elementos recibidos\n        this.pokemonList.addAll(nuevos);\n\n        // Notificamos al RecyclerView que hemos insertado un rango de elementos,\n        // para que solo actualice esa parte y no toda la lista (m\xe1s eficiente).\n        notifyItemRangeInserted(inicio, nuevos.size());\n    }\n\n\n    public class PokemonViewHolder extends RecyclerView.ViewHolder {\n\n        private final ViewholderPokemonBinding binding;\n\n        public PokemonViewHolder(@NonNull View itemView) {\n            super(itemView);\n            binding = ViewholderPokemonBinding.bind(itemView);\n        }\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["En este adapter tenemos dos m\xe9todos porque nuestra API usa ",(0,i.jsx)(n.strong,{children:"paginaci\xf3n"}),":"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"addPokemonList()"})," \u2192 a\xf1ade solo los nuevos elementos al final de la lista, ideal cuando la API devuelve resultados por p\xe1ginas (como ocurre con la Pok\xe9dex)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setPokemonList()"})," \u2192 reemplaza la lista completa y ser\xeda suficiente si la API devolviera ",(0,i.jsx)(n.strong,{children:"todos los Pok\xe9mon de una sola vez"}),", sin paginaci\xf3n. (No se est\xe1 usando, es para que lo tengas de referencia si tu API no tiene paginaci\xf3n.)"]}),"\n"]}),(0,i.jsxs)(n.p,{children:["En APIs sin paginaci\xf3n, normalmente solo necesitar\xedamos ",(0,i.jsx)(n.code,{children:"setPokemonList()"}),"."]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"paso-8-programar-el-pokedexfragment-y-conectar-todo",children:["Paso 8. Programar el ",(0,i.jsx)(n.code,{children:"PokedexFragment"})," y conectar todo"]}),"\n",(0,i.jsxs)(n.p,{children:["El ",(0,i.jsx)(n.code,{children:"PokedexFragment"})," es el encargado de mostrar la lista paginada de Pok\xe9mon y coordinar la comunicaci\xf3n entre la interfaz y el ",(0,i.jsx)(n.code,{children:"ViewModel"}),". Nada m\xe1s crearse la vista, el fragment obtiene una instancia del ",(0,i.jsx)(n.code,{children:"PokemonViewModel"}),", configura el ",(0,i.jsx)(n.code,{children:"RecyclerView"})," con su adaptador y se suscribe a los cambios del LiveData que contiene la Pok\xe9dex. De este modo, cualquier actualizaci\xf3n en los datos procedentes del Repository se reflejar\xe1 autom\xe1ticamente en pantalla."]}),"\n",(0,i.jsxs)(n.p,{children:["Cuando el fragment observa el LiveData, gestiona los tres estados del ",(0,i.jsx)(n.code,{children:"Resource"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"LOADING"})," \u2192 muestra un ",(0,i.jsx)(n.code,{children:"ProgressBar"})," para indicar que se est\xe1n cargando datos."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SUCCESS"})," \u2192 oculta el loading y a\xf1ade al ",(0,i.jsx)(n.code,{children:"RecyclerView"})," los nuevos Pok\xe9mon recibidos desde la API."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ERROR"})," \u2192 oculta la lista y muestra un mensaje de error si la petici\xf3n no se ha podido completar."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Esta separaci\xf3n clara de estados facilita una interfaz m\xe1s fluida y reactiva."}),"\n",(0,i.jsxs)(n.p,{children:["Adem\xe1s, el fragment implementa un ",(0,i.jsx)(n.strong,{children:"sistema de paginaci\xf3n autom\xe1tica"}),". A trav\xe9s de un ",(0,i.jsx)(n.code,{children:"OnScrollListener"}),", detecta cu\xe1ndo el usuario ha llegado al final del RecyclerView. En ese momento, llama al m\xe9todo ",(0,i.jsx)(n.code,{children:"cargarPokedex()"})," del ViewModel para solicitar la siguiente p\xe1gina de resultados. Gracias a esto, el usuario puede seguir haciendo scroll y la lista ir\xe1 creciendo conforme se descargan m\xe1s Pok\xe9mon, imitando el comportamiento t\xedpico de una app con scroll infinito."]}),"\n",(0,i.jsxs)(n.p,{children:["Por \xfaltimo, el fragment realiza una llamada inicial a ",(0,i.jsx)(n.code,{children:"cargarPokedex()"})," en ",(0,i.jsx)(n.code,{children:"onViewCreated()"})," para que la primera p\xe1gina de la Pok\xe9dex se cargue tan pronto como la pantalla est\xe9 lista, asegurando una experiencia r\xe1pida y sin retrasos."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class PokedexFragment extends Fragment {\n\n    private FragmentPokedexBinding binding;\n    private PokemonViewModel viewModel;\n    private PokemonAdapter adapter;\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        binding = FragmentPokedexBinding.inflate(inflater, container, false);\n        return binding.getRoot();\n    }\n\n    @Override\n    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n        super.onViewCreated(view, savedInstanceState);\n\n        viewModel = new ViewModelProvider(requireActivity()).get(PokemonViewModel.class);\n\n        configurarRecyclerView();\n        observarPokedex();\n        configurarPaginacion();\n\n        // Lanzamos la carga inicial\n        viewModel.cargarPokedex();\n    }\n\n    private void configurarRecyclerView() {\n        adapter = new PokemonAdapter(requireContext());\n        binding.recyclerPokedex.setAdapter(adapter);\n        binding.recyclerPokedex.setLayoutManager(new LinearLayoutManager(getContext()));\n    }\n\n    private void observarPokedex() {\n        viewModel.pokedex.observe(getViewLifecycleOwner(), resource -> {\n            if (resource == null) return;\n\n            // Gestionamos los diferentes estados\n            switch (resource.status) {\n                case LOADING:\n                    binding.progressLoadingPokedex.setVisibility(View.VISIBLE);\n                    binding.layoutErrorPokedex.setVisibility(View.GONE);\n                    binding.recyclerPokedex.setVisibility(View.VISIBLE);\n                    break;\n\n                case SUCCESS:\n                    binding.progressLoadingPokedex.setVisibility(View.GONE);\n                    binding.layoutErrorPokedex.setVisibility(View.GONE);\n                    binding.recyclerPokedex.setVisibility(View.VISIBLE);\n\n                    // A\xf1adimos a la lista del RecyclerView los 20 nuevos Pok\xe9mon recibidos\n                    adapter.addPokemonList(resource.data);\n                    break;\n\n                case ERROR:\n                    binding.progressLoadingPokedex.setVisibility(View.GONE);\n                    binding.recyclerPokedex.setVisibility(View.GONE);\n                    binding.layoutErrorPokedex.setVisibility(View.VISIBLE);\n                    binding.tvErrorPokedex.setText(resource.message);\n                    break;\n            }\n        });\n    }\n\n    // OJO: hacer esto solo si tu API tiene paginaci\xf3n\n    private void configurarPaginacion() {\n        // A\xf1adimos un listener al RecyclerView para detectar el scroll\n        binding.recyclerPokedex.addOnScrollListener(new RecyclerView.OnScrollListener() {\n\n            @Override\n            public void onScrolled(@NonNull RecyclerView recyclerView, int dx, int dy) {\n                super.onScrolled(recyclerView, dx, dy);\n\n                // Comprobamos si el usuario ha llegado al final del RecyclerView.\n                // canScrollVertically(1) devuelve false cuando NO se puede seguir bajando.\n                if (!recyclerView.canScrollVertically(1)) {\n\n                    // Si estamos en el final, pedimos al ViewModel que cargue la siguiente p\xe1gina\n                    viewModel.cargarPokedex();\n                }\n            }\n        });\n    }\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"mejoras-sobre-el-c\xf3digo-anterior",children:"Mejoras sobre el c\xf3digo anterior"}),"\n",(0,i.jsx)(n.h3,{id:"bloqueo-de-llamadas-repetidas-durante-la-paginaci\xf3n",children:"Bloqueo de llamadas repetidas durante la paginaci\xf3n"}),"\n",(0,i.jsxs)(n.p,{children:["Cuando el usuario hace scroll muy r\xe1pido hasta el final de la lista, Android puede disparar ",(0,i.jsx)(n.strong,{children:"varias veces seguidas"})," el evento del ",(0,i.jsx)(n.code,{children:"OnScrollListener"}),".\nEso significa que podr\xedamos llamar a:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"viewModel.cargarPokedex();\n"})}),"\n",(0,i.jsx)(n.p,{children:"tres, cuatro o incluso diez veces antes de que la API haya respondido a la primera."}),"\n",(0,i.jsx)(n.p,{children:"Observa como se saltan algunos Pok\xe9mon en la lista:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Demo app",src:o(69732).A+"",width:"388",height:"866"})}),"\n",(0,i.jsx)(n.p,{children:"Esto producir\xeda varios problemas:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Peticiones repetidas con el mismo offset"})}),"\n",(0,i.jsxs)(n.p,{children:["Hasta que no llega la respuesta, el ",(0,i.jsx)(n.code,{children:"OFFSET"})," no cambia.\nPor tanto, se repetir\xedan varias peticiones a:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"pokemon?limit=20&offset=0  \npokemon?limit=20&offset=0  \npokemon?limit=20&offset=0  \n"})}),"\n",(0,i.jsx)(n.p,{children:"La lista se llenar\xeda de duplicados."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Carga incorrecta de p\xe1ginas"})}),"\n",(0,i.jsx)(n.p,{children:"Si varias peticiones se completan en distinto orden (algo t\xedpico en redes m\xf3viles):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"P\xe1gina 2 puede llegar antes que p\xe1gina 1"}),"\n",(0,i.jsx)(n.li,{children:"O p\xe1gina 3 puede sobrescribir datos de p\xe1gina 2"}),"\n",(0,i.jsx)(n.li,{children:"Se mezclan resultados"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Esto ",(0,i.jsx)(n.strong,{children:"rompe por completo la paginaci\xf3n"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ineficiencia y sobrecarga en la red"})}),"\n",(0,i.jsx)(n.p,{children:"Hacer 5 peticiones simult\xe1neas a la API para obtener lo mismo:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Malgasta datos m\xf3viles"}),"\n",(0,i.jsx)(n.li,{children:"Aumenta los tiempos de respuesta"}),"\n",(0,i.jsx)(n.li,{children:"Saturar\xeda la app innecesariamente"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Este error podemos solucionarlo con un booleano que act\xfae como ",(0,i.jsx)(n.strong,{children:"sem\xe1foro"})," que controla el acceso a la operaci\xf3n de carga.\nCuando su valor es ",(0,i.jsx)(n.code,{children:"true"}),", es como si el sem\xe1foro estuviera en rojo:\nning\xfan otro hilo (o m\xe1s correctamente, ninguna otra llamada desde la UI) puede iniciar una nueva petici\xf3n a la API."]}),"\n",(0,i.jsxs)(n.p,{children:["Cuando la petici\xf3n termina (en \xe9xito o error), ponemos el booleano a ",(0,i.jsx)(n.code,{children:"true"})," y el sem\xe1foro vuelve a verde, permitiendo que se pueda solicitar la siguiente p\xe1gina."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class PokemonViewModel extends ViewModel {\n\n    private final PokemonRepository repository;\n    MutableLiveData<Resource<Pokemon>> informacionPokemon = new MutableLiveData<>();\n\n    MutableLiveData<Resource<List<PokedexResponse.PokedexEntry>>> pokedex = new MutableLiveData<>();\n\n    //highlight-next-line\n    // Sem\xe1foro de control de peticiones\n    //highlight-next-line\n    private boolean isLoading = false;\n\n    public PokemonViewModel() {\n        repository = new PokemonRepository();\n    }\n\n    public void buscarPokemon(String name) {\n        // ...\n    }\n\n    //highlight-start\n    public void cargarPokedex() {\n        if (isLoading) return;   // Si ya estamos cargando, salimos y NO lanzamos otra petici\xf3n\n        isLoading = true;        // Marcamos que una petici\xf3n est\xe1 en curso\n\n        repository.getPokedex(result -> {\n            pokedex.postValue(result);  // Enviamos al LiveData el resultado recibido\n\n            // Si la petici\xf3n ya termin\xf3 (success o error), desbloqueamos\n            switch (result.status) {\n                case ERROR:\n                case SUCCESS:\n                    isLoading = false;\n            }\n        });\n    }\n    //highlight-end\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pantalla-de-detalle",children:"Pantalla de detalle"}),"\n",(0,i.jsxs)(n.p,{children:["Para permitir que el usuario pueda consultar la informaci\xf3n completa de un Pok\xe9mon seleccion\xe1ndolo desde la Pok\xe9dex, necesitamos a\xf1adir un peque\xf1o flujo de navegaci\xf3n entre el ",(0,i.jsx)(n.code,{children:"RecyclerView"})," y la pantalla de detalle. A nivel te\xf3rico, el proceso consiste en los siguientes pasos:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Detectar el click del usuario en un elemento del RecyclerView"}),"\nEl ",(0,i.jsx)(n.code,{children:"Adapter"})," es el responsable de gestionar cada \xedtem, as\xed que es ah\xed donde debemos incluir un ",(0,i.jsx)(n.em,{children:"listener"})," de click.\nEsto se hace en ",(0,i.jsx)(n.code,{children:"onBindViewHolder"}),", asociando un ",(0,i.jsx)(n.code,{children:"setOnClickListener()"})," al ",(0,i.jsx)(n.code,{children:"itemView"}),".\nAs\xed sabremos exactamente qu\xe9 Pok\xe9mon ha pulsado el usuario.\nEsta parte es igual que lo que ya sabemos."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Obtener el identificador del Pok\xe9mon seleccionado"}),"\nDe cada entrada de la Pok\xe9dex podemos extraer su ",(0,i.jsx)(n.strong,{children:"id"})," (a partir de la URL) y enviarlo al ViewModel informando cu\xe1l es el Pok\xe9mon seleccionado."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Navegar hacia la pantalla de detalle"}),"\nDesde el Adapter usamos el ",(0,i.jsx)(n.em,{children:"Navigation Component"})," para ir a la pantalla de detalle."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solicitar los datos completos del Pok\xe9mon"}),"\nLa pantalla de detalle ya cuenta con un ",(0,i.jsx)(n.code,{children:"ViewModel"})," que tiene el m\xe9todo ",(0,i.jsx)(n.code,{children:"buscarPokemon(nombre)"})," o similar.\nCuando se abre, recibe el id/nombre desde los argumentos y llama al Repository para cargar la informaci\xf3n completa.\nEsto evita tener que duplicar c\xf3digo o crear l\xf3gica nueva: ",(0,i.jsx)(n.strong,{children:"reutilizamos completamente el sistema de b\xfasqueda del tutorial anterior"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Mostrar los datos completos del Pok\xe9mon"}),"\nEl Fragment de detalle observa el LiveData del ViewModel y actualiza la UI con nombre, altura, peso, tipos e im\xe1genes, tal como ya se implement\xf3 en la pantalla de b\xfasqueda."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["En resumen, la pantalla de detalle no necesita cambios importantes.\nSolo debemos ",(0,i.jsx)(n.strong,{children:"enlazar la Pok\xe9dex con ella"}),", detectando qu\xe9 Pok\xe9mon seleccion\xf3 el usuario y reenviando ese valor al ViewModel para que consulte toda la informaci\xf3n en la PokeAPI."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},69732:(e,n,o)=>{o.d(n,{A:()=>a});const a=o.p+"assets/images/demo-error-carga-c054d3664e9a1ab44481ca1d96a94b62.gif"},90766:(e,n,o)=>{o.d(n,{A:()=>a});const a=o.p+"assets/images/demo-pokedex-api-755b95fb67aec12ffdf1f4e1f374272e.gif"}}]);