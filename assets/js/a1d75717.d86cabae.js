"use strict";(self.webpackChunkpmdm=self.webpackChunkpmdm||[]).push([[2218],{28453:(e,n,a)=>{a.d(n,{R:()=>t,x:()=>o});var i=a(96540);const r={},s=i.createContext(r);function t(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(s.Provider,{value:n},e.children)}},42494:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"pmdm_2526/ut4_componentes_avanzados/arquitectura-aplicacion","title":"Arquitectura de la aplicaci\xf3n","description":"Explicaci\xf3n te\xf3rica de la arquitectura MVVM con Repository para consumir APIs en Android. Componentes necesarios, flujo de comunicaci\xf3n y uso de una clase Wrapper para gestionar los estados de las peticiones.","source":"@site/docs/01_pmdm_2526/ut4_componentes_avanzados/3-arquitectura-aplicacion.md","sourceDirName":"01_pmdm_2526/ut4_componentes_avanzados","slug":"/pmdm_2526/ut4_componentes_avanzados/arquitectura-aplicacion","permalink":"/DevTacora/docs/pmdm_2526/ut4_componentes_avanzados/arquitectura-aplicacion","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Arquitectura de la aplicaci\xf3n","sidebar_position":3,"description":"Explicaci\xf3n te\xf3rica de la arquitectura MVVM con Repository para consumir APIs en Android. Componentes necesarios, flujo de comunicaci\xf3n y uso de una clase Wrapper para gestionar los estados de las peticiones.","keywords":["MVVM","Repository","Retrofit","Arquitectura","Android","ViewModel","Fragment","API","Wrapper","Estados"]},"sidebar":"pmdm_2526_Sidebar","previous":{"title":"An\xe1lisis de la PokeAPI","permalink":"/DevTacora/docs/pmdm_2526/ut4_componentes_avanzados/analisis-pokeapi"},"next":{"title":"Tutorial: B\xfasqueda de Pok\xe9mon","permalink":"/DevTacora/docs/pmdm_2526/ut4_componentes_avanzados/tutorial-busqueda-pkm"}}');var r=a(74848),s=a(28453);const t={title:"Arquitectura de la aplicaci\xf3n",sidebar_position:3,description:"Explicaci\xf3n te\xf3rica de la arquitectura MVVM con Repository para consumir APIs en Android. Componentes necesarios, flujo de comunicaci\xf3n y uso de una clase Wrapper para gestionar los estados de las peticiones.",keywords:["MVVM","Repository","Retrofit","Arquitectura","Android","ViewModel","Fragment","API","Wrapper","Estados"]},o=void 0,l={},c=[{value:"Componentes de la arquitectura",id:"componentes-de-la-arquitectura",level:2},{value:"Flujo de comunicaci\xf3n entre componentes",id:"flujo-de-comunicaci\xf3n-entre-componentes",level:3},{value:"Componentes de Retrofit",id:"componentes-de-retrofit",level:3},{value:"Cliente Retrofit (Retrofit Client)",id:"cliente-retrofit-retrofit-client",level:4},{value:"Interfaz de Endpoints (API Interface)",id:"interfaz-de-endpoints-api-interface",level:4},{value:"Clase Wrapper para gestionar estados",id:"clase-wrapper-para-gestionar-estados",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Cuando una aplicaci\xf3n Android consume datos de una API externa, es importante organizar el proyecto siguiendo una arquitectura clara que separe responsabilidades.\nEn este tema utilizaremos el patr\xf3n ",(0,r.jsx)(n.strong,{children:"MVVM (Model\u2013View\u2013ViewModel)"})," junto con un ",(0,r.jsx)(n.strong,{children:"Repository"}),", siguiendo la misma estructura que ya aprendimos en el tema anterior, lo que nos permitir\xe1:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Mantener el c\xf3digo limpio y ordenado."}),"\n",(0,r.jsx)(n.li,{children:"Evitar que el Fragment realice l\xf3gica pesada."}),"\n",(0,r.jsx)(n.li,{children:"Facilitar pruebas y mantenimiento."}),"\n",(0,r.jsx)(n.li,{children:"Reutilizar el c\xf3digo que gestiona la comunicaci\xf3n con la API."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["En resumen: ",(0,r.jsx)(n.strong,{children:"cada capa se encarga de una tarea concreta"}),", evitando mezclar la l\xf3gica de red con la interfaz gr\xe1fica."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"componentes-de-la-arquitectura",children:"Componentes de la arquitectura"}),"\n",(0,r.jsx)(n.p,{children:"La arquitectura que utilizaremos se basa en tres capas principales, acompa\xf1adas por Retrofit como herramienta para realizar las peticiones HTTP."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Componente"}),(0,r.jsx)(n.th,{children:"Rol principal"}),(0,r.jsx)(n.th,{children:"Responsabilidades"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Fragment (Vista)"})}),(0,r.jsx)(n.td,{children:"Interfaz de usuario"}),(0,r.jsx)(n.td,{children:"Muestra datos. Recoge acciones del usuario (b\xfasqueda, clics...). Observa el ViewModel. No realiza llamadas a la API."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"ViewModel"})}),(0,r.jsx)(n.td,{children:"Intermediario entre vista y datos"}),(0,r.jsx)(n.td,{children:"Solicita datos al Repository. Expone LiveData. Mantiene el estado aunque se destruya el Fragment. No realiza llamadas a la API."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Repository"})}),(0,r.jsx)(n.td,{children:"Capa de acceso a datos"}),(0,r.jsx)(n.td,{children:"Realiza peticiones HTTP usando Retrofit. Decide qu\xe9 datos devolver. Gestiona errores de red o API."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Retrofit (Cliente + Interface)"})}),(0,r.jsx)(n.td,{children:"Comunicaci\xf3n con la API"}),(0,r.jsx)(n.td,{children:"Cliente configurado con la URL base. Interface que define los endpoints. Realiza las peticiones HTTP."})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"flujo-de-comunicaci\xf3n-entre-componentes",children:"Flujo de comunicaci\xf3n entre componentes"}),"\n",(0,r.jsx)(n.p,{children:"A nivel te\xf3rico, el flujo funciona as\xed:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["El ",(0,r.jsx)(n.strong,{children:"Fragment"})," solicita una b\xfasqueda o carga de datos."]}),"\n",(0,r.jsxs)(n.li,{children:["El ",(0,r.jsx)(n.strong,{children:"ViewModel"})," recibe la petici\xf3n y llama al Repository."]}),"\n",(0,r.jsxs)(n.li,{children:["El ",(0,r.jsx)(n.strong,{children:"Repository"})," usa Retrofit para enviar la petici\xf3n a la API."]}),"\n",(0,r.jsx)(n.li,{children:"La API devuelve una respuesta (JSON), que el Repository transforma si es necesario."}),"\n",(0,r.jsxs)(n.li,{children:["El ",(0,r.jsx)(n.strong,{children:"ViewModel"})," recibe los datos y los expone a la vista."]}),"\n",(0,r.jsxs)(n.li,{children:["El ",(0,r.jsx)(n.strong,{children:"Fragment"})," observa esos cambios y actualiza la UI."]}),"\n"]}),"\n",(0,r.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant F as Fragment\n    participant VM as ViewModel\n    participant R as Repository\n    participant API as API REST\n\n    F--\x3e>VM: Establece observador sobre LiveData\n    F->>VM: Solicita datos (ej: buscar Pok\xe9mon)\n    VM->>R: Pide datos al Repository\n    R->>API: Llamada HTTP con Retrofit\n    API--\x3e>R: Respuesta JSON\n    R--\x3e>VM: Devuelve resultado (\xe9xito/error)\n    VM--\x3e>F: Actualiza LiveData\n    F->>F: Actualiza interfaz"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"componentes-de-retrofit",children:"Componentes de Retrofit"}),"\n",(0,r.jsxs)(n.p,{children:["Para consumir una API REST en Android utilizando Retrofit necesitamos ",(0,r.jsx)(n.strong,{children:"dos componentes fundamentales"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"El cliente Retrofit"}),", encargado de configurar la conexi\xf3n con la API."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"La interfaz de endpoints"}),", que define qu\xe9 peticiones podemos realizar."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Retrofit divide estas responsabilidades para mantener el c\xf3digo limpio y f\xe1cil de mantener."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"cliente-retrofit-retrofit-client",children:"Cliente Retrofit (Retrofit Client)"}),"\n",(0,r.jsx)(n.p,{children:"El cliente Retrofit es el objeto responsable de:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Establecer la ",(0,r.jsx)(n.strong,{children:"URL base"})," de la API."]}),"\n",(0,r.jsx)(n.li,{children:"Indicar c\xf3mo se deben convertir las respuestas JSON (por ejemplo, usando Gson)."}),"\n",(0,r.jsx)(n.li,{children:"Crear e inicializar la conexi\xf3n con el servidor."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Normalmente este cliente se implementa usando el ",(0,r.jsx)(n.strong,{children:"patr\xf3n Singleton"}),", para que exista ",(0,r.jsx)(n.strong,{children:"una \xfanica instancia"})," durante toda la aplicaci\xf3n."]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo conceptual:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public class RetrofitClient {\n\n    private static final String BASE_URL = "https://pokeapi.co/api/v2/";\n    private static Retrofit instance;\n\n    public static Retrofit getInstance() {\n        if (instance == null) {\n            instance = new Retrofit.Builder()\n                    .baseUrl(BASE_URL)\n                    .addConverterFactory(GsonConverterFactory.create()) // Convierte JSON a Java\n                    .build();\n        }\n        return instance;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Puntos clave:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"baseUrl()"})," \u2192 define la URL principal."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"addConverterFactory()"})," \u2192 indica c\xf3mo interpretar el JSON (Gson)."]}),"\n",(0,r.jsxs)(n.li,{children:["Esta clase ",(0,r.jsx)(n.strong,{children:"no hace peticiones por s\xed sola"}),"; solo configura la conexi\xf3n."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"interfaz-de-endpoints-api-interface",children:"Interfaz de Endpoints (API Interface)"}),"\n",(0,r.jsxs)(n.p,{children:["En Retrofit, las peticiones a la API se declaran en ",(0,r.jsx)(n.strong,{children:"una interfaz Java"}),".\nCada m\xe9todo representa un endpoint y utiliza anotaciones como ",(0,r.jsx)(n.code,{children:"@GET"}),", ",(0,r.jsx)(n.code,{children:"@POST"}),", ",(0,r.jsx)(n.code,{children:"@Path"}),", ",(0,r.jsx)(n.code,{children:"@Query"}),", etc."]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo te\xf3rico para obtener un Pok\xe9mon:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public interface PokemonApi {\n\n    @GET("pokemon/{name}")\n    Call<Pokemon> getPokemonByName(@Path("name") String name);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Explicaci\xf3n:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'@GET("pokemon/{name}")'})," \u2192 indica que es una petici\xf3n GET al endpoint ",(0,r.jsx)(n.code,{children:"/pokemon/{name}"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{name}"})," es un valor variable que se sustituir\xe1 en tiempo de ejecuci\xf3n."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'@Path("name")'})," vincula el par\xe1metro del m\xe9todo con el valor del endpoint."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Call<Pokemon>"})," indica el tipo de dato que esperamos recibir mapeado desde el JSON."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Para usar esta interfaz junto al cliente:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"PokemonApi api = RetrofitClient.getInstance().create(PokemonApi.class);\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"clase-wrapper-para-gestionar-estados",children:"Clase Wrapper para gestionar estados"}),"\n",(0,r.jsx)(n.p,{children:"Cuando se trabaja con APIs, no basta con devolver datos:\nes necesario gestionar tambi\xe9n el estado de la petici\xf3n."}),"\n",(0,r.jsxs)(n.p,{children:["Por eso utilizaremos una ",(0,r.jsx)(n.strong,{children:"clase Wrapper"})," que represente:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Loading"})," \u2192 La petici\xf3n se est\xe1 realizando."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Success"})," \u2192 La API devuelve datos correctamente."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Error"})," \u2192 Ha ocurrido un problema (404, red, etc.)."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Esto permite que la vista pueda mostrar:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"un spinner"}),"\n",(0,r.jsx)(n.li,{children:"un mensaje de error"}),"\n",(0,r.jsx)(n.li,{children:"o los datos finales"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"dependiendo del estado."}),"\n",(0,r.jsx)(n.p,{children:"Un ejemplo conceptual:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class Resource<T> {\n    public T data;\n    public String message;\n    public Status status; // SUCCESS, ERROR, LOADING\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Esto no es implementaci\xf3n completa, solo una referencia te\xf3rica."})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);