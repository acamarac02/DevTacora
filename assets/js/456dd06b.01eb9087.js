"use strict";(self.webpackChunkpmdm=self.webpackChunkpmdm||[]).push([[5772],{13523:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/crear-proyecto-f3623ebe38b4ed9c24f5c5f59826f0a9.png"},16972:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/descargar-google-services-json-fc9019ec9f01eb437662166bc81472aa.png"},22930:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/app-login-mail-pass-1eaeea383ec8d710ad891ae2ac5695e2.gif"},28219:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/arquitectura-firebase-auth-15e74156a6ba98a2fdd107082d677624.png"},28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>s});var i=a(96540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},36508:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/metodo-user-pass-5f587ecdb2e08ed47c728361adc884a9.png"},42306:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/agregar-proyecto-android-2-820d5d615697c82699120cecdb899d3f.png"},71509:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"pmdm_2526/ut5_persistencia/firebase/authentication/demo-mail-pass","title":"Demo - Autenticaci\xf3n con email y contrase\xf1a","description":"Tutorial guiado para implementar login y registro con email/contrase\xf1a usando Firebase Authentication en Android (Java), siguiendo arquitectura MVVM + Repository con AndroidViewModel.","source":"@site/docs/01_pmdm_2526/ut5_persistencia/4-firebase/1-authentication/1-demo-mail-pass.md","sourceDirName":"01_pmdm_2526/ut5_persistencia/4-firebase/1-authentication","slug":"/pmdm_2526/ut5_persistencia/firebase/authentication/demo-mail-pass","permalink":"/DevTacora/docs/pmdm_2526/ut5_persistencia/firebase/authentication/demo-mail-pass","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Demo - Autenticaci\xf3n con email y contrase\xf1a","sidebar_position":1,"description":"Tutorial guiado para implementar login y registro con email/contrase\xf1a usando Firebase Authentication en Android (Java), siguiendo arquitectura MVVM + Repository con AndroidViewModel.","keywords":["Firebase Authentication","Firebase Auth","Android","Java","Login","Registro","Email","Password","MVVM","Repository","AndroidViewModel"]},"sidebar":"pmdm_2526_Sidebar","previous":{"title":"Conceptos te\xf3ricos","permalink":"/DevTacora/docs/pmdm_2526/ut5_persistencia/firebase/authentication/conceptos-teoricos"},"next":{"title":"Demo - Autenticaci\xf3n con Google (Gmail)","permalink":"/DevTacora/docs/pmdm_2526/ut5_persistencia/firebase/authentication/demo-gmail"}}');var t=a(74848),r=a(28453);const o={title:"Demo - Autenticaci\xf3n con email y contrase\xf1a",sidebar_position:1,description:"Tutorial guiado para implementar login y registro con email/contrase\xf1a usando Firebase Authentication en Android (Java), siguiendo arquitectura MVVM + Repository con AndroidViewModel.",keywords:["Firebase Authentication","Firebase Auth","Android","Java","Login","Registro","Email","Password","MVVM","Repository","AndroidViewModel"]},s=void 0,d={},l=[{value:"Paso 1. Configurar Firebase en tu Proyecto Android",id:"paso-1-configurar-firebase-en-tu-proyecto-android",level:2},{value:"1.1. Crear un Proyecto en Firebase",id:"11-crear-un-proyecto-en-firebase",level:3},{value:"1.2. Agregar dependencias de Firebase",id:"12-agregar-dependencias-de-firebase",level:3},{value:"1.3. Habilita el m\xe9todo de acceso",id:"13-habilita-el-m\xe9todo-de-acceso",level:3},{value:"Paso 2. Dise\xf1o de la Interfaz de Usuario",id:"paso-2-dise\xf1o-de-la-interfaz-de-usuario",level:2},{value:"2.1. Activity Login",id:"21-activity-login",level:3},{value:"2.2. Activity Principal",id:"22-activity-principal",level:3},{value:"Paso 3. Programar la l\xf3gica de usuario",id:"paso-3-programar-la-l\xf3gica-de-usuario",level:2},{value:"3.1. Implementar el Repository",id:"31-implementar-el-repository",level:3},{value:"3.2. Clase Wrapper para gestionar estados de autenticaci\xf3n",id:"32-clase-wrapper-para-gestionar-estados-de-autenticaci\xf3n",level:3},{value:"3.3. Implementar el ViewModel",id:"33-implementar-el-viewmodel",level:3},{value:"3.4. LoginActivity",id:"34-loginactivity",level:3},{value:"3.5. MainActivity",id:"35-mainactivity",level:3}];function c(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)("div",{class:"justify-text",children:[(0,t.jsx)(n.p,{children:"Vamos a implementar una aplicaci\xf3n sencilla con una pantalla \xfanica de log in y registro. Una vez que el usuario se haya logueado, pasarmos a la pantalla principal de la aplicaci\xf3n."}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"UT5. GIF resumen de la aplicaci\xf3n",src:a(22930).A+"",width:"378",height:"836"})}),(0,t.jsx)(n.p,{children:"La arquitectura ser\xe1 MVVM con Repository, tal y como estamos ya acostumbrados:"}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Arquitectura",src:a(28219).A+"",width:"2549",height:"2118"})}),(0,t.jsx)(n.h2,{id:"paso-1-configurar-firebase-en-tu-proyecto-android",children:"Paso 1. Configurar Firebase en tu Proyecto Android"}),(0,t.jsx)(n.p,{children:"Antes de comenzar a programar, debes configurar Firebase en tu aplicaci\xf3n."}),(0,t.jsx)(n.h3,{id:"11-crear-un-proyecto-en-firebase",children:"1.1. Crear un Proyecto en Firebase"}),(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Ve a la ",(0,t.jsx)(n.a,{href:"https://console.firebase.google.com/",children:"Firebase Console"})," y crea un nuevo proyecto."]}),"\n"]}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Crear proyecto Firebase",src:a(13523).A+"",width:"3358",height:"2018"})}),(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["Agrega una aplicaci\xf3n ",(0,t.jsx)(n.strong,{children:"Android"})," e ingresa el ",(0,t.jsx)(n.strong,{children:"nombre del paquete"})," de tu app."]}),"\n"]}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Agregar proyecto Android",src:a(42306).A+"",width:"3350",height:"1640"})}),(0,t.jsx)(n.admonition,{title:"Nombre del paquete",type:"info",children:(0,t.jsx)(n.p,{children:"Por lo general, el nombre de tu paquete es el valor del applicationId en el archivo build.gradle de nivel de app."})}),(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["Descarga el archivo ",(0,t.jsx)(n.strong,{children:"google-services.json"})," y col\xf3calo en ",(0,t.jsx)(n.code,{children:"app/"})," dentro de tu proyecto. Para ello, ",(0,t.jsx)(n.strong,{children:"cambia la vista de Android a Proyecto en Android Studio"}),". Puedes seguir las instrucciones del wizard."]}),"\n"]}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Descargar Google Services JSON",src:a(16972).A+"",width:"3354",height:"1862"})}),(0,t.jsx)(n.h3,{id:"12-agregar-dependencias-de-firebase",children:"1.2. Agregar dependencias de Firebase"}),(0,t.jsxs)(n.p,{children:["Abre el archivo ",(0,t.jsx)(n.code,{children:"build.gradle (Project Level)"})," y agrega el plugin de Google Services:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-gradle",children:'plugins {\n    // ...\n\n    // Add the dependency for the Google services Gradle plugin\n    id("com.google.gms.google-services") version "4.4.4" apply false\n}\n'})}),(0,t.jsxs)(n.p,{children:["Luego, en ",(0,t.jsx)(n.code,{children:"build.gradle (Module: app)"}),", agrega el complemento de google-services y a\xf1ade las dependencias de Firebase Authentication:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-gradle",children:'plugins {\n\n  // Add the Google services Gradle plugin\n  id("com.google.gms.google-services")\n\n  // ...\n}\n\ndependencies {\n    // Firebase\n    implementation(platform("com.google.firebase:firebase-bom:34.8.0"))\n    // Firebase Authentication\n    implementation("com.google.firebase:firebase-auth")\n}\n'})}),(0,t.jsxs)(n.p,{children:["Despu\xe9s de esto, ",(0,t.jsx)(n.strong,{children:"sincroniza el proyecto"})," (",(0,t.jsx)(n.code,{children:"Sync Now"})," en Android Studio)."]}),(0,t.jsx)(n.h3,{id:"13-habilita-el-m\xe9todo-de-acceso",children:"1.3. Habilita el m\xe9todo de acceso"}),(0,t.jsx)(n.p,{children:"En el panel de control, selecciona Compilaci\xf3n > Authentication."}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Auth en el panel",src:a(95233).A+"",width:"484",height:"890"})}),(0,t.jsxs)(n.p,{children:["En la pesta\xf1a ",(0,t.jsx)(n.code,{children:"M\xe9todo de acceso"}),", habilita los proveedores con los que quieres permitir el acceso. En este caso, con email y contrase\xf1a."]}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"M\xe9todos de acceso",src:a(83743).A+"",width:"3354",height:"1410"})}),(0,t.jsx)(n.p,{children:"Dentro de las dos opciones, en nuestra aplicaci\xf3n ser\xe1 obligatorio establecer una contrase\xf1a. Por tanto, solo habilitamos la primera opci\xf3n."}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"M\xe9todo usuario y contrase\xf1a",src:a(36508).A+"",width:"2428",height:"1182"})}),(0,t.jsx)(n.hr,{}),(0,t.jsx)(n.h2,{id:"paso-2-dise\xf1o-de-la-interfaz-de-usuario",children:"Paso 2. Dise\xf1o de la Interfaz de Usuario"}),(0,t.jsxs)(n.p,{children:["Partimos de una ",(0,t.jsx)(n.strong,{children:"aplicaci\xf3n muy sencilla con dos Activities"}),", sin uso de Fragmentos. Recuerda que en tus aplicaciones reales s\xed deber\xe1s usar fragmentos y todo lo aprendido hasta ahora."]}),(0,t.jsx)(n.h3,{id:"21-activity-login",children:"2.1. Activity Login"}),(0,t.jsxs)(n.p,{children:["En ",(0,t.jsx)(n.code,{children:"activity_login.xml"}),", crea una interfaz para el ",(0,t.jsx)(n.strong,{children:"registro e inicio de sesi\xf3n"}),"."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",metastring:'title="activity_login.xml"',children:'<LinearLayout\n    xmlns:android="http://schemas.android.com/apk/res/android"\n    xmlns:app="http://schemas.android.com/apk/res-auto"\n    xmlns:tools="http://schemas.android.com/tools"\n    android:layout_width="match_parent"\n    android:layout_height="match_parent"\n    android:gravity="center"\n    android:layout_gravity="center"\n    android:orientation="vertical"\n    android:padding="20dp"\n    tools:context=".MainActivity">\n\n    <LinearLayout\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:gravity="center"\n        android:orientation="vertical"\n        android:padding="20dp">\n\n        \x3c!-- Email --\x3e\n        <com.google.android.material.textfield.TextInputLayout\n            android:layout_width="match_parent"\n            android:layout_height="wrap_content"\n            app:boxBackgroundMode="outline">\n\n            <com.google.android.material.textfield.TextInputEditText\n                android:id="@+id/emailEditText"\n                android:layout_width="match_parent"\n                android:layout_height="wrap_content"\n                android:hint="Correo Electr\xf3nico"\n                android:inputType="textEmailAddress"/>\n        </com.google.android.material.textfield.TextInputLayout>\n\n        \x3c!-- Password --\x3e\n        <com.google.android.material.textfield.TextInputLayout\n            android:layout_width="match_parent"\n            android:layout_height="wrap_content"\n            android:layout_marginTop="10dp"\n            app:boxBackgroundMode="outline">\n\n            <com.google.android.material.textfield.TextInputEditText\n                android:id="@+id/passwordEditText"\n                android:layout_width="match_parent"\n                android:layout_height="wrap_content"\n                android:hint="Contrase\xf1a"\n                android:inputType="textPassword"/>\n        </com.google.android.material.textfield.TextInputLayout>\n\n        \x3c!-- Botones --\x3e\n        <LinearLayout\n            android:layout_width="match_parent"\n            android:layout_height="wrap_content"\n            android:layout_marginTop="20dp"\n            android:gravity="center"\n            android:orientation="horizontal"\n            android:paddingHorizontal="8dp">\n\n            <com.google.android.material.button.MaterialButton\n                android:id="@+id/registerButton"\n                android:layout_width="0dp"\n                android:layout_height="wrap_content"\n                android:layout_weight="1"\n                android:text="Registrarse"\n                android:layout_marginEnd="8dp" />\n\n            <com.google.android.material.button.MaterialButton\n                android:id="@+id/loginButton"\n                android:layout_width="0dp"\n                android:layout_height="wrap_content"\n                android:layout_weight="1"\n                android:text="Iniciar Sesi\xf3n"\n                android:layout_marginStart="8dp" />\n        </LinearLayout>\n\n        \x3c!-- ProgressBar --\x3e\n        <ProgressBar\n            android:id="@+id/progressBar"\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:layout_marginTop="20dp"\n            android:visibility="gone"\n            android:indeterminate="true"/>\n\n    </LinearLayout>\n\n</LinearLayout>\n'})}),(0,t.jsxs)(n.admonition,{title:"ACTIVITY INICIAL",type:"info",children:[(0,t.jsx)(n.p,{children:"Recuerda marcar Login Activity como actividad principal de tu aplicaci\xf3n:"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",metastring:'title="AndroidManifest.xml"',children:'<activity\n    android:name=".LoginActivity"\n    android:exported="true">\n    <intent-filter>\n        <action android:name="android.intent.action.MAIN" />\n        <category android:name="android.intent.category.LAUNCHER" />\n    </intent-filter>\n</activity>\n<activity\n    android:name=".MainActivity"\n    android:exported="false">\n</activity>\n'})})]}),(0,t.jsx)(n.hr,{}),(0,t.jsx)(n.h3,{id:"22-activity-principal",children:"2.2. Activity Principal"}),(0,t.jsx)(n.p,{children:"En esta Activity mostraremos informaci\xf3n b\xe1sica que devuelve Firebase Auth sobre el usuario. Adem\xe1s, ofreceremos un bot\xf3n para cerrar la sesi\xf3n."}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",metastring:'title="activity_main.xml"',children:'<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"\n    xmlns:app="http://schemas.android.com/apk/res-auto"\n    xmlns:tools="http://schemas.android.com/tools"\n    android:layout_width="match_parent"\n    android:layout_height="match_parent"\n    android:padding="20dp"\n    android:gravity="center"\n    android:orientation="vertical"\n    tools:context=".MainActivity">\n\n    \x3c!-- T\xedtulo --\x3e\n    <TextView\n        android:layout_width="wrap_content"\n        android:layout_height="wrap_content"\n        android:text="Informaci\xf3n del Usuario"\n        android:textSize="22sp"\n        android:textStyle="bold"\n        android:paddingBottom="16dp"/>\n\n    \x3c!-- Secci\xf3n: Correo --\x3e\n    <LinearLayout\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:orientation="horizontal"\n        android:paddingBottom="8dp">\n\n        <TextView\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:text="Correo: "\n            android:textSize="16sp"\n            android:textStyle="bold"/>\n\n        <TextView\n            android:id="@+id/emailTextView"\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:textSize="16sp"/>\n    </LinearLayout>\n\n    \x3c!-- Secci\xf3n: Fecha de Creaci\xf3n --\x3e\n    <LinearLayout\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:orientation="horizontal"\n        android:paddingBottom="8dp">\n\n        <TextView\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:text="Fecha de Creaci\xf3n: "\n            android:textSize="16sp"\n            android:textStyle="bold"/>\n\n        <TextView\n            android:id="@+id/creationDateTextView"\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:textSize="16sp"/>\n    </LinearLayout>\n\n    \x3c!-- Secci\xf3n: \xdaltima Conexi\xf3n --\x3e\n    <LinearLayout\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:orientation="horizontal"\n        android:paddingBottom="16dp">\n\n        <TextView\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:text="\xdaltima Conexi\xf3n: "\n            android:textSize="16sp"\n            android:textStyle="bold"/>\n\n        <TextView\n            android:id="@+id/lastLoginTextView"\n            android:layout_width="wrap_content"\n            android:layout_height="wrap_content"\n            android:textSize="16sp"/>\n    </LinearLayout>\n\n    \x3c!-- Bot\xf3n de Logout --\x3e\n    <com.google.android.material.button.MaterialButton\n        android:id="@+id/logoutButton"\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"\n        android:text="Cerrar Sesi\xf3n"\n        style="@style/Widget.MaterialComponents.Button"/>\n</LinearLayout>\n'})}),(0,t.jsx)(n.hr,{}),(0,t.jsx)(n.h2,{id:"paso-3-programar-la-l\xf3gica-de-usuario",children:"Paso 3. Programar la l\xf3gica de usuario"}),(0,t.jsx)(n.h3,{id:"31-implementar-el-repository",children:"3.1. Implementar el Repository"}),(0,t.jsxs)(n.p,{children:["Creamos un repositorio que sea el \xfanico que conozca y se comunique con ",(0,t.jsx)(n.code,{children:"FirebaseAuth"}),"."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",metastring:'title="AuthRepository.java"',children:'public class AuthRepository {\n\n    // Instancia de FirebaseAuth que gestiona la autenticaci\xf3n en la app.\n    private final FirebaseAuth auth;\n\n    public AuthRepository() {\n        auth = FirebaseAuth.getInstance();\n    }\n\n    /**\n     * Callback para comunicar el resultado de una operaci\xf3n de autenticaci\xf3n (login/registro).\n     * Se utiliza porque las llamadas a Firebase son as\xedncronas.\n     */\n    public interface AuthCallback {\n        // Se ejecuta cuando la operaci\xf3n ha sido exitosa. Devuelve la informaci\xf3n del usuario autenticado.\n        void onSuccess(FirebaseUser user);\n        // Se ejecuta cuando la operaci\xf3n falla.\n        void onError(String message);\n    }\n\n    // Inicia sesi\xf3n con email y contrase\xf1a.\n    // Notifica el resultado mediante AuthCallback\n    public void login(String email, String password, AuthCallback callback) {\n        // Operaci\xf3n as\xedncrona: Firebase devuelve un Task y se resuelve en los listeners.\n        auth.signInWithEmailAndPassword(email, password)\n                // Si se autentica correctamente, devolvemos el usuario actual.\n                .addOnSuccessListener(result -> callback.onSuccess(auth.getCurrentUser()))\n                // Si falla, mapeamos la excepci\xf3n a un mensaje y lo devolvemos.\n                .addOnFailureListener(e -> callback.onError(mapError(e)));\n    }\n\n    // Registra un nuevo usuario con email y contrase\xf1a.\n    // Notifica el resultado mediante AuthCallback\n    public void register(String email, String password, AuthCallback callback) {\n        auth.createUserWithEmailAndPassword(email, password)\n                .addOnSuccessListener(result -> callback.onSuccess(auth.getCurrentUser()))\n                .addOnFailureListener(e -> callback.onError(mapError(e)));\n    }\n\n    // Devuelve el usuario actualmente autenticado (si hay alguno).\n    public FirebaseUser getCurrentUser() {\n        return auth.getCurrentUser();\n    }\n\n    // Cierra sesi\xf3n del usuario actual.\n    public void logout() {\n        auth.signOut();\n    }\n\n    // Convierte una excepci\xf3n en un mensaje de error para mostrar.\n    private String mapError(Exception e) {\n        // Si no hay excepci\xf3n o no hay mensaje, devolvemos un texto gen\xe9rico.\n        if (e == null || e.getMessage() == null) return "Error desconocido.";\n        // Si no, devolvemos el mensaje original de Firebase.\n        return e.getMessage();\n    }\n}\n'})}),(0,t.jsx)(n.hr,{}),(0,t.jsx)(n.h3,{id:"32-clase-wrapper-para-gestionar-estados-de-autenticaci\xf3n",children:"3.2. Clase Wrapper para gestionar estados de autenticaci\xf3n"}),(0,t.jsxs)(n.p,{children:["En temas anteriores ya hemos trabajado con una ",(0,t.jsxs)(n.strong,{children:["clase wrapper (",(0,t.jsx)(n.code,{children:"Resource"}),")"]})," para representar el estado de una llamada a una ",(0,t.jsx)(n.strong,{children:"API REST"}),":\n",(0,t.jsx)(n.em,{children:"cargando"}),", ",(0,t.jsx)(n.em,{children:"\xe9xito"})," o ",(0,t.jsx)(n.em,{children:"error"}),"."]}),(0,t.jsxs)(n.p,{children:["Cuando trabajamos con ",(0,t.jsx)(n.strong,{children:"Firebase Authentication"}),", el problema es muy similar:"]}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Las operaciones de ",(0,t.jsx)(n.strong,{children:"login"})," y ",(0,t.jsx)(n.strong,{children:"registro"})," son ",(0,t.jsx)(n.strong,{children:"as\xedncronas"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"La UI necesita saber en qu\xe9 estado se encuentra la operaci\xf3n para:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"mostrar o bloquear elementos de la interfaz,"}),"\n",(0,t.jsx)(n.li,{children:"navegar a otra pantalla si todo va bien,"}),"\n",(0,t.jsx)(n.li,{children:"o mostrar un mensaje de error si algo falla."}),"\n"]}),"\n"]}),"\n"]}),(0,t.jsxs)(n.p,{children:["Por este motivo, reutilizamos el ",(0,t.jsx)(n.strong,{children:"mismo patr\xf3n"}),", pero adaptado al contexto de autenticaci\xf3n."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class AuthState {\n\n    public boolean loading;\n    public FirebaseUser user;\n    public String error;\n\n    public static AuthState loading() {\n        AuthState s = new AuthState();\n        s.loading = true;\n        return s;\n    }\n\n    public static AuthState success(FirebaseUser user) {\n        AuthState s = new AuthState();\n        s.user = user;\n        return s;\n    }\n\n    public static AuthState error(String msg) {\n        AuthState s = new AuthState();\n        s.error = msg;\n        return s;\n    }\n}\n"})}),(0,t.jsx)(n.admonition,{title:"Significado de cada estado",type:"info",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Loading"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"La operaci\xf3n de login o registro est\xe1 en curso."}),"\n",(0,t.jsx)(n.li,{children:"Se utiliza para desactivar botones, inputs o mostrar un indicador de carga."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Success"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"La autenticaci\xf3n se ha realizado correctamente."}),"\n",(0,t.jsxs)(n.li,{children:["Contiene un ",(0,t.jsx)(n.code,{children:"FirebaseUser"})," con la informaci\xf3n del usuario autenticado."]}),"\n",(0,t.jsx)(n.li,{children:"La UI suele reaccionar navegando a otra pantalla."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Error"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"La operaci\xf3n ha fallado."}),"\n",(0,t.jsx)(n.li,{children:"Contiene un mensaje de error que puede mostrarse al usuario."}),"\n"]}),"\n"]}),"\n"]})}),(0,t.jsx)(n.hr,{}),(0,t.jsx)(n.h3,{id:"33-implementar-el-viewmodel",children:"3.3. Implementar el ViewModel"}),(0,t.jsx)(n.p,{children:"El ViewModel:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"valida las entradas del usuario"}),"\n",(0,t.jsx)(n.li,{children:"actualiza estado (loading, error, user)"}),"\n",(0,t.jsx)(n.li,{children:"llama al repositorio para realizar las operaciones de autenticaci\xf3n"}),"\n"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",metastring:'title="AuthViewModel"',children:'public class AuthViewModel extends AndroidViewModel {\n\n    private final AuthRepository repo;\n\n    // LiveData para los m\xe9todos as\xedncronos del repositorio\n    private final MutableLiveData<AuthState> authState = new MutableLiveData<>();\n\n    public AuthViewModel(@NonNull Application application) {\n        super(application);\n        repo = new AuthRepository();\n    }\n\n    // Getter p\xfablico del LiveData\n    public MutableLiveData<AuthState> getAuthState() {\n        return authState;\n    }\n\n    // No es una petici\xf3n as\xedncrona ni un cambio de estado, es una consulta directa y s\xedncrona.\n    // Podemos devolverlo sin necesidad de un LiveData\n    public FirebaseUser getCurrentUser() {\n        return repo.getCurrentUser();\n    }\n\n    // M\xe9todo para realizar el logout\n    public void logout() {\n        repo.logout();\n    }\n\n    // M\xe9todo para realizar el login\n    public void login(String email, String password) {\n        // Primera validaci\xf3n\n        String error = validate(email, password);\n        if (error != null) {\n            // Si no pasa la validaci\xf3n, devolvemos mensaje de error\n            authState.setValue(AuthState.error(error));\n            return;\n        }\n\n        // Anunciamos que estamos lanzando la petici\xf3n (puede tardar as\xed que podemos\n        // mostrar un progress bar)\n        authState.setValue(AuthState.loading());\n\n        // Lanzamos la petici\xf3n a Firebase\n        repo.login(email.trim(), password, new AuthRepository.AuthCallback() {\n            @Override public void onSuccess(FirebaseUser user) {\n                // Si va bien, devolvemos la informaci\xf3n del usuario\n                authState.postValue(AuthState.success(user));\n            }\n            @Override public void onError(String message) {\n                // Si va mal, devolvemos el mensaje de error\n                authState.postValue(AuthState.error(message));\n            }\n        });\n    }\n\n    // M\xe9todo de registro, l\xf3gica similar al login\n    public void register(String email, String password) {\n        String error = validate(email, password);\n        if (error != null) {\n            authState.setValue(AuthState.error(error));\n            return;\n        }\n\n        authState.setValue(AuthState.loading());\n        repo.register(email.trim(), password, new AuthRepository.AuthCallback() {\n            @Override public void onSuccess(FirebaseUser user) {\n                authState.postValue(AuthState.success(user));\n            }\n            @Override public void onError(String message) {\n                authState.postValue(AuthState.error(message));\n            }\n        });\n    }\n\n\n    // Validaci\xf3n b\xe1sica de los campos que introduce el usuario\n    // Recomendable antes de enviar petici\xf3n a Firebase\n    private String validate(String email, String password) {\n        if (email == null || email.trim().isEmpty()) return "El correo es obligatorio.";\n        if (password == null || password.isEmpty()) return "La contrase\xf1a es obligatoria.";\n        return null;\n    }\n\n}\n'})}),(0,t.jsx)(n.hr,{}),(0,t.jsx)(n.h3,{id:"34-loginactivity",children:"3.4. LoginActivity"}),(0,t.jsxs)(n.p,{children:["Nuestro layout tiene dos botones: ",(0,t.jsx)(n.strong,{children:"registrarse"})," y ",(0,t.jsx)(n.strong,{children:"login"}),".\nAs\xed que el flujo es directo:"]}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"registerButton"})," \u2192 ",(0,t.jsx)(n.code,{children:"viewModel.register(email, pass)"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"loginButton"})," \u2192 ",(0,t.jsx)(n.code,{children:"viewModel.login(email, pass)"})]}),"\n"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",metastring:'title="LoginActivity.java"',children:"public class LoginActivity extends AppCompatActivity {\n\n    private AuthViewModel viewModel;\n    private ActivityLoginBinding binding;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView((binding = ActivityLoginBinding.inflate(getLayoutInflater())).getRoot());\n\n        viewModel = new ViewModelProvider(this).get(AuthViewModel.class);\n\n        // Si ya hay usuario autenticado, saltamos directamente a la pantalla principal\n        if (viewModel.getCurrentUser() != null) {\n            goToMain();\n            return;\n        }\n\n        // Inicializaci\xf3n de componentes\n        observeAuthState();\n        inicializarBotones();\n    }\n\n    private void observeAuthState() {\n        viewModel.getAuthState().observe(this, state -> {\n            if (state == null) return;\n\n            // Deshabilita botones y muestra la progress bar si la petici\xf3n est\xe1 en proceso\n            habilitarInterfaz(state.loading);\n\n            // Si hay un error, mostramos el mensaje\n            if (state.error != null) {\n                Toast.makeText(this, state.error, Toast.LENGTH_LONG).show();\n                return;\n            }\n\n            // Si todo va bien, pasamos a la pantalla principal\n            if (state.user != null) {\n                goToMain();\n            }\n        });\n    }\n\n    private void habilitarInterfaz(boolean cargando) {\n        // Si est\xe1 cargando, deshabilitamos todos los botones y mostramos la barra de progreso\n        if (cargando) {\n            binding.registerButton.setEnabled(false);\n            binding.loginButton.setEnabled(false);\n            binding.emailEditText.setEnabled(false);\n            binding.passwordEditText.setEnabled(false);\n            binding.progressBar.setVisibility(View.VISIBLE);\n        } else {\n            binding.registerButton.setEnabled(true);\n            binding.loginButton.setEnabled(true);\n            binding.emailEditText.setEnabled(true);\n            binding.passwordEditText.setEnabled(true);\n            binding.progressBar.setVisibility(View.GONE);\n        }\n    }\n\n    private void inicializarBotones() {\n        binding.registerButton.setOnClickListener(v -> {\n            // Recuperamos mail y contrase\xf1a\n            String email = binding.emailEditText.getText().toString();\n            String pass = binding.passwordEditText.getText().toString();\n            // Iniciamos el proceso de registro\n            viewModel.register(email, pass);\n        });\n\n        binding.loginButton.setOnClickListener(v -> {\n            // Recuperamos mail y contrase\xf1a\n            String email = binding.emailEditText.getText().toString();\n            String pass = binding.passwordEditText.getText().toString();\n            // Iniciamos el proceso de login\n            viewModel.login(email, pass);\n        });\n    }\n\n    // M\xe9todo que navega a la pantalla principal\n    private void goToMain() {\n        startActivity(new Intent(this, MainActivity.class));\n        finish();\n    }\n}\n"})}),(0,t.jsx)(n.hr,{}),(0,t.jsx)(n.h3,{id:"35-mainactivity",children:"3.5. MainActivity"}),(0,t.jsxs)(n.p,{children:["Nuestro layout tiene un conjunto de campo para mostrar informaci\xf3n b\xe1sica del usuario, que recuperaremos de ",(0,t.jsx)(n.code,{children:"Firebase"}),", concretamente del objeto ",(0,t.jsx)(n.code,{children:"FirebaseUser"}),"."]}),(0,t.jsx)(n.p,{children:"Adem\xe1s, tiene un bot\xf3n de logout que cierra la sesi\xf3n del usuario y devuelve a la actividad de login/registro."}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",metastring:'title="MainActivity.java"',children:'public class MainActivity extends AppCompatActivity {\n\n    private AuthViewModel viewModel;\n\n    private ActivityMainBinding binding;\n\n    private FirebaseUser user;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView((binding = ActivityMainBinding.inflate(getLayoutInflater())).getRoot());\n\n        viewModel = new ViewModelProvider(this).get(AuthViewModel.class);\n\n        user = viewModel.getCurrentUser();\n\n        // Si no hay un usuario conectado (porque ha pasado mucho tiempo desde el \xfaltimo login,\n        // se ha borrado cach\xe9 de la aplicaci\xf3n, etc.)\n        if (user == null) {\n            goToLogin();\n            return;\n        }\n\n        mostrarDatosUsuario();\n        \n        inicializarBotonLogout();\n    }\n    \n    private void inicializarBotonLogout() {\n        binding.logoutButton.setOnClickListener(v -> {\n            viewModel.logout();\n            goToLogin();\n        });\n    }\n\n    private void mostrarDatosUsuario() {\n        binding.emailTextView.setText(user.getEmail());\n\n        // FirebaseUserMetadata contiene informaci\xf3n adicional del usuario\n        FirebaseUserMetadata meta = user.getMetadata();\n        if (meta != null) {\n            binding.creationDateTextView.setText(formatearFecha(meta.getCreationTimestamp()));\n            binding.lastLoginTextView.setText(formatearFecha(meta.getLastSignInTimestamp()));\n        } else {\n            binding.creationDateTextView.setText("-");\n            binding.lastLoginTextView.setText("-");\n        }\n    }\n\n    private void goToLogin() {\n        startActivity(new Intent(this, LoginActivity.class));\n        finish();\n    }\n\n    private String formatearFecha(long timestamp) {\n        // timestamp viene en ms\n        SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm", Locale.getDefault());\n        return sdf.format(new Date(timestamp));\n    }\n}\n'})}),(0,t.jsxs)(n.admonition,{title:"Clases FirebaseUser y FirebaseUserMetadata",type:"info",children:[(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"FirebaseUser"})," representa al usuario autenticado en Firebase Authentication.",(0,t.jsx)(n.br,{}),"\n","Contiene la informaci\xf3n b\xe1sica de la cuenta, como el correo electr\xf3nico, el identificador \xfanico (UID) y el estado de verificaci\xf3n del email."]}),(0,t.jsx)(n.p,{children:"Algunos datos habituales que proporciona:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getUid()"})," \u2192 identificador \xfanico del usuario."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getEmail()"})," \u2192 correo electr\xf3nico asociado a la cuenta."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"isEmailVerified()"})," \u2192 indica si el correo ha sido verificado."]}),"\n"]}),(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"FirebaseUserMetadata"})," contiene informaci\xf3n adicional sobre la cuenta del usuario, relacionada con su actividad en la aplicaci\xf3n."]}),(0,t.jsx)(n.p,{children:"Permite conocer, entre otros datos:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getCreationTimestamp()"})," \u2192 fecha y hora de creaci\xf3n de la cuenta."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getLastSignInTimestamp()"})," \u2192 fecha y hora del \xfaltimo inicio de sesi\xf3n."]}),"\n"]}),(0,t.jsx)(n.p,{children:"Esta clase se obtiene a trav\xe9s de:"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"FirebaseUserMetadata metadata = user.getMetadata();\n"})}),(0,t.jsxs)(n.p,{children:["Estas clases permiten acceder a informaci\xf3n del usuario autenticado ",(0,t.jsx)(n.strong,{children:"sin realizar llamadas adicionales a red"}),", ya que Firebase mantiene estos datos de forma local mientras la sesi\xf3n est\xe9 activa."]})]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},83743:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/metodo-acceso-c68d3d8894166841e0835496c8de375e.png"},95233:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/panel-auth-23ea4e2259facfa2925eadf97e1a56ae.png"}}]);