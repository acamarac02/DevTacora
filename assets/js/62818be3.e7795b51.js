"use strict";(self.webpackChunkpmdm=self.webpackChunkpmdm||[]).push([[7324],{28453:(e,s,a)=>{a.d(s,{R:()=>c,x:()=>o});var r=a(96540);const i={},n=r.createContext(i);function c(e){const s=r.useContext(n);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(n.Provider,{value:s},e.children)}},57244:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>t,contentTitle:()=>o,default:()=>l,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"pmdm_2425/ut5_persistencia/supabase-storage/arquitectura-seguridad","title":"Arquitectura y Seguridad de Supabase Storage","description":"Arquitectura y Organizaci\xf3n de Supabase Storage","source":"@site/docs/00_pmdm_2425/ut5_persistencia/5-supabase-storage/1-arquitectura-seguridad.md","sourceDirName":"00_pmdm_2425/ut5_persistencia/5-supabase-storage","slug":"/pmdm_2425/ut5_persistencia/supabase-storage/arquitectura-seguridad","permalink":"/DevTacora/docs/pmdm_2425/ut5_persistencia/supabase-storage/arquitectura-seguridad","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Arquitectura y Seguridad","title":"Arquitectura y Seguridad de Supabase Storage"},"sidebar":"pmdm_2425_Sidebar","previous":{"title":"Supabase Storage","permalink":"/DevTacora/docs/pmdm_2425/ut5_persistencia/supabase-storage/"},"next":{"title":"Configuraci\xf3n Inicial","permalink":"/DevTacora/docs/pmdm_2425/ut5_persistencia/supabase-storage/configuracion-inicial"}}');var i=a(74848),n=a(28453);const c={sidebar_position:1,sidebar_label:"Arquitectura y Seguridad",title:"Arquitectura y Seguridad de Supabase Storage"},o=void 0,t={},d=[{value:"Arquitectura y Organizaci\xf3n de Supabase Storage",id:"arquitectura-y-organizaci\xf3n-de-supabase-storage",level:2},{value:"Buckets: qu\xe9 son y c\xf3mo usarlos",id:"buckets-qu\xe9-son-y-c\xf3mo-usarlos",level:3},{value:"Organizaci\xf3n de archivos dentro de un bucket",id:"organizaci\xf3n-de-archivos-dentro-de-un-bucket",level:3},{value:"Rutas y URLs p\xfablicas y privadas",id:"rutas-y-urls-p\xfablicas-y-privadas",level:3},{value:"\ud83d\udd39 <strong>Ejemplo de ruta interna en un bucket (<code>anuncios</code>)</strong>:",id:"-ejemplo-de-ruta-interna-en-un-bucket-anuncios",level:4},{value:"\ud83d\udd39 <strong>Ejemplo de URL p\xfablica</strong> (si el bucket es p\xfablico):",id:"-ejemplo-de-url-p\xfablica-si-el-bucket-es-p\xfablico",level:4},{value:"\ud83d\udd39 <strong>Ejemplo de URL privada</strong> (si el bucket es privado):",id:"-ejemplo-de-url-privada-si-el-bucket-es-privado",level:4},{value:"Configuraci\xf3n de Seguridad y Reglas de Acceso",id:"configuraci\xf3n-de-seguridad-y-reglas-de-acceso",level:2},{value:"Definir Pol\xedticas RLS (Row Level Security)",id:"definir-pol\xedticas-rls-row-level-security",level:3},{value:"Buckets P\xfablicos vs Privados",id:"buckets-p\xfablicos-vs-privados",level:3}];function u(e){const s={admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.R)(),...e.components};return(0,i.jsxs)("div",{class:"justify-text",children:[(0,i.jsx)(s.h2,{id:"arquitectura-y-organizaci\xf3n-de-supabase-storage",children:"Arquitectura y Organizaci\xf3n de Supabase Storage"}),(0,i.jsxs)(s.p,{children:["Supabase Storage est\xe1 dise\xf1ado para gestionar archivos de manera eficiente, proporcionando almacenamiento en la nube con control de acceso flexible. En este apartado, exploraremos c\xf3mo organizar los archivos dentro de un ",(0,i.jsx)(s.strong,{children:"bucket"}),", c\xf3mo se estructuran las ",(0,i.jsx)(s.strong,{children:"rutas de archivos"})," y la diferencia entre ",(0,i.jsx)(s.strong,{children:"URLs p\xfablicas y privadas"}),"."]}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h3,{id:"buckets-qu\xe9-son-y-c\xf3mo-usarlos",children:"Buckets: qu\xe9 son y c\xf3mo usarlos"}),(0,i.jsxs)(s.p,{children:["Un ",(0,i.jsx)(s.strong,{children:"bucket"})," es un contenedor donde se almacenan archivos dentro de Supabase Storage. Funciona de manera similar a una carpeta en la nube y cada proyecto en Supabase puede tener m\xfaltiples buckets, cada uno con sus propias reglas de acceso."]}),(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Ejemplo de buckets en un proyecto Supabase"}),":"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"/anuncios (P\xfablico)  \n  \u251c\u2500\u2500 imagen1.jpg  \n  \u251c\u2500\u2500 imagen2.jpg  \n\n/perfiles (Privado)  \n  \u251c\u2500\u2500 usuario_123.jpg  \n  \u251c\u2500\u2500 usuario_456.jpg  \n"})}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h3,{id:"organizaci\xf3n-de-archivos-dentro-de-un-bucket",children:"Organizaci\xf3n de archivos dentro de un bucket"}),(0,i.jsxs)(s.p,{children:["Dentro de un bucket, los archivos se organizan en una ",(0,i.jsx)(s.strong,{children:"estructura jer\xe1rquica"})," similar a un sistema de archivos. Puedes crear carpetas para categorizar los archivos y mantener un orden l\xf3gico."]}),(0,i.jsxs)(s.p,{children:[(0,i.jsxs)(s.strong,{children:["Ejemplo de organizaci\xf3n en un bucket ",(0,i.jsx)(s.code,{children:"anuncios"})]}),":"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"/anuncios  \n  \u251c\u2500\u2500 usuario_123  \n  \u2502      \u251c\u2500\u2500 imagen1.jpg  \n  \u2502      \u251c\u2500\u2500 imagen2.jpg  \n  \u251c\u2500\u2500 usuario_456  \n  \u2502      \u251c\u2500\u2500 imagen3.jpg  \n  \u2502      \u251c\u2500\u2500 imagen4.jpg  \n"})}),(0,i.jsxs)(s.p,{children:["\ud83d\udd39 ",(0,i.jsx)(s.strong,{children:"Beneficios de organizar los archivos por carpetas"}),":",(0,i.jsx)(s.br,{}),"\n","\u2705 Facilita la b\xfasqueda y recuperaci\xf3n de archivos.",(0,i.jsx)(s.br,{}),"\n","\u2705 Permite aplicar reglas de acceso diferentes por carpeta.",(0,i.jsx)(s.br,{}),"\n","\u2705 Reduce conflictos de nombres entre archivos de distintos usuarios."]}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h3,{id:"rutas-y-urls-p\xfablicas-y-privadas",children:"Rutas y URLs p\xfablicas y privadas"}),(0,i.jsxs)(s.p,{children:["Cada archivo en Supabase Storage tiene una ",(0,i.jsx)(s.strong,{children:"ruta \xfanica"})," dentro de su bucket y, dependiendo de la configuraci\xf3n del bucket, puede tener una ",(0,i.jsx)(s.strong,{children:"URL p\xfablica"})," o requerir autenticaci\xf3n para acceder."]}),(0,i.jsxs)(s.h4,{id:"-ejemplo-de-ruta-interna-en-un-bucket-anuncios",children:["\ud83d\udd39 ",(0,i.jsxs)(s.strong,{children:["Ejemplo de ruta interna en un bucket (",(0,i.jsx)(s.code,{children:"anuncios"}),")"]}),":"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"/anuncios/usuario_123/imagen1.jpg\n"})}),(0,i.jsxs)(s.h4,{id:"-ejemplo-de-url-p\xfablica-si-el-bucket-es-p\xfablico",children:["\ud83d\udd39 ",(0,i.jsx)(s.strong,{children:"Ejemplo de URL p\xfablica"})," (si el bucket es p\xfablico):"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"https://<tu-proyecto>.supabase.co/storage/v1/object/public/anuncios/usuario_123/imagen1.jpg\n"})}),(0,i.jsx)(s.p,{children:"\ud83d\udc49 Cualquiera puede acceder a esta URL sin autenticaci\xf3n."}),(0,i.jsxs)(s.h4,{id:"-ejemplo-de-url-privada-si-el-bucket-es-privado",children:["\ud83d\udd39 ",(0,i.jsx)(s.strong,{children:"Ejemplo de URL privada"})," (si el bucket es privado):"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"https://<tu-proyecto>.supabase.co/storage/v1/object/anuncios/usuario_123/imagen1.jpg\n"})}),(0,i.jsx)(s.p,{children:"\ud83d\udc49 No accesible directamente. Se necesita un token de acceso para verla."}),(0,i.jsxs)(s.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(s.strong,{children:"Nota:"})," Si un bucket es privado, se deben usar ",(0,i.jsx)(s.strong,{children:"tokens de acceso temporales"})," o autenticaci\xf3n para acceder a los archivos. Esto se explica en el siguiente apartado."]}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h2,{id:"configuraci\xf3n-de-seguridad-y-reglas-de-acceso",children:"Configuraci\xf3n de Seguridad y Reglas de Acceso"}),(0,i.jsxs)(s.p,{children:["La seguridad en ",(0,i.jsx)(s.strong,{children:"Supabase Storage"})," se gestiona mediante ",(0,i.jsx)(s.strong,{children:"Row Level Security (RLS)"}),", que define qui\xe9n puede leer, escribir o eliminar archivos. Es fundamental configurar correctamente estas reglas para evitar accesos no autorizados."]}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h3,{id:"definir-pol\xedticas-rls-row-level-security",children:"Definir Pol\xedticas RLS (Row Level Security)"}),(0,i.jsxs)(s.p,{children:["Las ",(0,i.jsx)(s.strong,{children:"pol\xedticas RLS"})," controlan el acceso a los archivos de un bucket. Sin una pol\xedtica definida, Supabase ",(0,i.jsx)(s.strong,{children:"bloquear\xe1 todas las operaciones por defecto"}),". Para modificar esto, debemos crear reglas en SQL."]}),(0,i.jsxs)(s.p,{children:["\ud83d\udd39 ",(0,i.jsx)(s.strong,{children:"Ejemplo de pol\xedtica para permitir a los usuarios autenticados subir archivos"}),":"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE POLICY \"permitir usuarios autenticados subir archivos\"\nON storage.objects\nFOR INSERT\nTO authenticated\nWITH CHECK (auth.role() = 'authenticated');\n"})}),(0,i.jsxs)(s.p,{children:["\ud83d\udd39 ",(0,i.jsx)(s.strong,{children:"Ejemplo de pol\xedtica para permitir a los usuarios autenticados leer archivos"}),":"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE POLICY \"permitir usuarios autenticados leer archivos\"\nON storage.objects\nFOR SELECT\nTO authenticated\nUSING (auth.role() = 'authenticated');\n"})}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h3,{id:"buckets-p\xfablicos-vs-privados",children:"Buckets P\xfablicos vs Privados"}),(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"\ud83d\udd39 Caracter\xedstica"}),(0,i.jsx)(s.th,{children:"\ud83d\udd13 P\xfablico"}),(0,i.jsx)(s.th,{children:"\ud83d\udd12 Privado"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Acceso sin autenticaci\xf3n"})}),(0,i.jsx)(s.td,{children:"\u2705 S\xed"}),(0,i.jsx)(s.td,{children:"\u274c No"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Ideal para..."})}),(0,i.jsx)(s.td,{children:"Im\xe1genes accesibles para todos (ej. im\xe1genes de productos)"}),(0,i.jsx)(s.td,{children:"Archivos sensibles (ej. fotos de perfil privadas)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Requiere reglas RLS"})}),(0,i.jsx)(s.td,{children:"\u274c No"}),(0,i.jsx)(s.td,{children:"\u2705 S\xed"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Genera URL de acceso directo"})}),(0,i.jsx)(s.td,{children:"\u2705 S\xed"}),(0,i.jsx)(s.td,{children:"\u274c No"})]})]})]}),(0,i.jsx)(s.admonition,{title:"\xbfCu\xe1ndo usar cada tipo?",type:"info",children:(0,i.jsxs)(s.p,{children:["\u2705 ",(0,i.jsx)(s.strong,{children:"Usa buckets p\xfablicos"})," si los archivos deben ser accesibles sin autenticaci\xf3n, como im\xe1genes de productos o fondos de una web.",(0,i.jsx)(s.br,{}),"\n","\u2705 ",(0,i.jsx)(s.strong,{children:"Usa buckets privados"})," si los archivos deben ser protegidos, como documentos privados o fotos de perfil de usuarios."]})})]})}function l(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}}}]);