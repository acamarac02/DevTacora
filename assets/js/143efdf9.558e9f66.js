"use strict";(self.webpackChunkpmdm=self.webpackChunkpmdm||[]).push([[2425],{18314:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/demo-sp-2be584495865452d673653b524007909.gif"},28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var i=r(96540);const a={},s=i.createContext(a);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(s.Provider,{value:n},e.children)}},51178:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"pmdm_2526/ut5_persistencia/shared-preferences/demo-uso","title":"Demo de uso","description":"Ejemplo pr\xe1ctico de uso de SharedPreferences siguiendo la arquitectura MVVM con Repository para mostrar un di\xe1logo solo la primera vez que se abre la app.","source":"@site/docs/01_pmdm_2526/ut5_persistencia/3-shared-preferences/2-demo-uso.md","sourceDirName":"01_pmdm_2526/ut5_persistencia/3-shared-preferences","slug":"/pmdm_2526/ut5_persistencia/shared-preferences/demo-uso","permalink":"/DevTacora/docs/pmdm_2526/ut5_persistencia/shared-preferences/demo-uso","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Demo de uso","sidebar_position":2,"description":"Ejemplo pr\xe1ctico de uso de SharedPreferences siguiendo la arquitectura MVVM con Repository para mostrar un di\xe1logo solo la primera vez que se abre la app.","keywords":["SharedPreferences","MVVM","Repository","Android","Dialog","Primer ingreso"]},"sidebar":"pmdm_2526_Sidebar","previous":{"title":"Conceptos te\xf3ricos","permalink":"/DevTacora/docs/pmdm_2526/ut5_persistencia/shared-preferences/conceptos-teoricos"}}');var a=r(74848),s=r(28453);const o={title:"Demo de uso",sidebar_position:2,description:"Ejemplo pr\xe1ctico de uso de SharedPreferences siguiendo la arquitectura MVVM con Repository para mostrar un di\xe1logo solo la primera vez que se abre la app.",keywords:["SharedPreferences","MVVM","Repository","Android","Dialog","Primer ingreso"]},l=void 0,t={},c=[{value:"Paso 1. Estructura inicial",id:"paso-1-estructura-inicial",level:2},{value:"Paso 2. Crear el Repository",id:"paso-2-crear-el-repository",level:2},{value:"Paso 3. Crear el ViewModel",id:"paso-3-crear-el-viewmodel",level:2},{value:"Paso 4. Programar el Fragment",id:"paso-4-programar-el-fragment",level:2}];function d(e){const n={admonition:"admonition",code:"code",h2:"h2",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["En este ejemplo vamos a implementar una funcionalidad muy habitual en aplicaciones Android:\n",(0,a.jsx)(n.strong,{children:"mostrar un di\xe1logo \xfanicamente la primera vez que el usuario abre la app"}),"."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Demo app",src:r(18314).A+"",width:"388",height:"868"})}),"\n",(0,a.jsx)(n.p,{children:"Para ello utilizaremos:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"SharedPreferences"})," para persistir el dato"]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Arquitectura MVVM + Repository"})}),"\n",(0,a.jsxs)(n.li,{children:["Una ",(0,a.jsx)(n.strong,{children:"Activity contenedora"})]}),"\n",(0,a.jsxs)(n.li,{children:["Toda la l\xf3gica en el ",(0,a.jsx)(n.strong,{children:"Fragment"})," principal"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"El comportamiento esperado es:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["La primera vez que se abre la app \u2192 se muestra un ",(0,a.jsx)(n.code,{children:"AlertDialog"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"Cuando el usuario confirma el di\xe1logo \u2192 se guarda que ya no es primer ingreso."}),"\n",(0,a.jsxs)(n.li,{children:["En aperturas posteriores \u2192 el di\xe1logo ",(0,a.jsx)(n.strong,{children:"no vuelve a mostrarse"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"paso-1-estructura-inicial",children:"Paso 1. Estructura inicial"}),"\n",(0,a.jsx)(n.p,{children:"Partimos de una aplicaci\xf3n con un grafo de navegaci\xf3n y:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"MainActivity"})," (actividad contenedora)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"HomeFragment"})," (pantalla principal)"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"paso-2-crear-el-repository",children:"Paso 2. Crear el Repository"}),"\n",(0,a.jsxs)(n.p,{children:["El ",(0,a.jsx)(n.strong,{children:"Repository"})," ser\xe1 la \xfanica clase que conozca ",(0,a.jsx)(n.code,{children:"SharedPreferences"}),".\nAqu\xed centralizamos la lectura y escritura del flag ",(0,a.jsx)(n.code,{children:"primer_ingreso"})," y de todas las variables que necesites almacenar."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",metastring:'title="PreferencesRepository.java"',children:'public class PreferencesRepository {\n\n    private static final String PREFS_NAME = "prefs";\n    private static final String KEY_PRIMER_INGRESO = "primer_ingreso";\n\n    private final SharedPreferences sharedPreferences;\n\n    public PreferencesRepository(Context context) {\n        sharedPreferences = context.getApplicationContext()\n                .getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);\n    }\n\n    public boolean isPrimerIngreso() {\n        // Si no existe el valor, asumimos que es la primera vez\n        return sharedPreferences.getBoolean(KEY_PRIMER_INGRESO, true);\n    }\n\n    public void setPrimerIngreso(boolean value) {\n        sharedPreferences.edit()                        // abrimos un editor\n                .putBoolean(KEY_PRIMER_INGRESO, value)  // guardamos el valor\n                .apply();                               // confirmamos cambios\n    }\n\n}\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"paso-3-crear-el-viewmodel",children:"Paso 3. Crear el ViewModel"}),"\n",(0,a.jsxs)(n.p,{children:["El ",(0,a.jsx)(n.strong,{children:"ViewModel"})," es el encargado de transmitir la informaci\xf3n de manera as\xedncrona entre la vista (el Fragment) y la fuente de datos (el repositorio)."]}),"\n",(0,a.jsxs)(n.p,{children:["Como necesitamos ",(0,a.jsx)(n.code,{children:"Context"})," para crear el repository, utilizamos ",(0,a.jsx)(n.code,{children:"AndroidViewModel"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",metastring:'title="MainViewModel.java"',children:"public class MainViewModel extends AndroidViewModel {\n\n    private final PreferencesRepository repository;\n    private MutableLiveData<Boolean> primerIngreso = new MutableLiveData<>();\n\n    public MainViewModel(@NonNull Application application) {\n        super(application);\n        repository = new PreferencesRepository(application);\n    }\n\n    /**\n     * M\xe9todo que actualiza un MutableLiveData con el valor almacenado\n     * en las Preferences del primer ingreso\n     */\n    public void comprobarPrimerIngreso() {\n        primerIngreso.postValue(repository.isPrimerIngreso());\n    }\n\n    /**\n     * M\xe9todo que almacena en las SharedPreferences que el usuario\n     * ya realiz\xf3 el primer ingreso\n     */\n    public void actualizarPrimerIngreso() {\n        repository.setPrimerIngreso(false);\n    }\n\n    ///  Getter para el LiveData\n    public MutableLiveData<Boolean> getPrimerIngreso() {\n        return primerIngreso;\n    }\n}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"paso-4-programar-el-fragment",children:"Paso 4. Programar el Fragment"}),"\n",(0,a.jsx)(n.p,{children:"El Fragment:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Obtiene el ViewModel"}),"\n",(0,a.jsxs)(n.li,{children:["Observa el valor almacenado en las ",(0,a.jsx)(n.code,{children:"SharedPreferences"})]}),"\n",(0,a.jsxs)(n.li,{children:["Muestra el ",(0,a.jsx)(n.code,{children:"AlertDialog"})]}),"\n",(0,a.jsx)(n.li,{children:"Notifica al ViewModel cuando el usuario confirma"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",metastring:'title="MainFragment.java"',children:'public class HomeFragment extends Fragment {\n\n    private MainViewModel viewModel;\n    private FragmentHomeBinding binding;\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        // Inflate the layout for this fragment\n        return (binding = FragmentHomeBinding.inflate(inflater, container, false)).getRoot();\n    }\n\n    @Override\n    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n        super.onViewCreated(view, savedInstanceState);\n\n        viewModel = new ViewModelProvider(this).get(MainViewModel.class);\n        \n        // Invocamos el m\xe9todo que consulta el valor almacenado\n        viewModel.comprobarPrimerIngreso();\n        \n        // Configuramos un observador sobre el LiveData\n        observadorPrimerIngreso();\n    }\n\n    private void observadorPrimerIngreso() {\n        viewModel.getPrimerIngreso().observe(getViewLifecycleOwner(), esPrimerIngreso -> {\n            if (esPrimerIngreso) {\n                mostrarDialogo();\n            }\n        });\n    }\n\n    private void mostrarDialogo() {\n        new AlertDialog.Builder(requireContext())\n                .setTitle("\xa1Bienvenido!")\n                .setMessage("Gracias por instalar nuestra aplicaci\xf3n. \xa1Esperamos que te guste!")\n                .setCancelable(false)\n                .setPositiveButton("Continuar", (dialog, which) -> {\n                    // Cuando el usuario pulsa el bot\xf3n continuar, actualizamos\n                    // las preferences para indicar que ya se ha hecho\n                    // el primer ingreso\n                    viewModel.actualizarPrimerIngreso();\n                    // Cerramos el di\xe1logo\n                    dialog.dismiss();\n                })\n                .show();\n    }\n\n}\n'})}),"\n",(0,a.jsxs)(n.admonition,{title:"ALERT DIALOG",type:"info",children:[(0,a.jsxs)(n.p,{children:["Un ",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"AlertDialog"})})," es una ventana emergente (popup) que aparece sobre la interfaz de usuario para mostrar mensajes, advertencias o pedir confirmaci\xf3n al usuario."]}),(0,a.jsx)(n.p,{children:"Sus caracter\xedsticas principales son:"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"No interrumpe el flujo de la actividad."})}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Bloquea la interacci\xf3n con otros elementos"})," hasta que el usuario interact\xfaa con el di\xe1logo."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Opcionalmente puede tener botones"}),":","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Positivo (OK, Aceptar)"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Negativo (Cancelar)"}),"."]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Neutral (Opcional para otra acci\xf3n como 'M\xe1s tarde')."})}),"\n"]}),"\n"]}),"\n"]}),(0,a.jsxs)(n.p,{children:["Los principales par\xe1metros que admite un ",(0,a.jsx)(n.code,{children:"AlertDialog"})," son:"]}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"setTitle()"})}),": T\xedtulo del di\xe1logo."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"setMessage()"})}),": Mensaje dentro del popup."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"setPositiveButton()"})}),": Bot\xf3n de acci\xf3n positiva (ej: Aceptar, Guardar)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"setNegativeButton()"})}),": Bot\xf3n de acci\xf3n negativa (ej: Cancelar)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"setNeutralButton()"})}),": Bot\xf3n neutral (ej: M\xe1s tarde)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"setView()"})}),": Permite a\xf1adir una vista personalizada (como un ",(0,a.jsx)(n.code,{children:"EditText"}),")."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"setItems()"})}),": Lista de opciones."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"setCancelable()"})}),": Controla si el usuario puede cerrar el di\xe1logo tocando fuera de \xe9l o presionando el bot\xf3n de atr\xe1s (Back)."]}),"\n"]}),(0,a.jsx)(n.p,{children:"Como puedes observar son altamente personalizables."})]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);